{% extends "layout.html" %}
{% block title %}MODIFICAR PRESUPUESTO{% endblock %}

{% block customCSS %}

{% endblock %}

{% block titutlo %}MODIFICAR PRESUPUESTO{% endblock %}

{% block content %}


<br>
<div class="container-fluid">
    <form class="needs-validation" novalidate accion="/Presupuestos" method="post">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <input type="hidden" name="token" value="{{ token }}">
    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
        <div class="text-center">
            <button class="btn botones" type="submit">CONFIRMA</button>
        </div>
    </div>

    <br>

    <div class="card mb-3">
        <div class="card-body">
           
            <div class="table-responsive">
                <table class="table table-borderless heder-presupuestos">
                    <colgroup>
                        <col style="width: 150px"> <!-- Primera columna -->
                        <col style="width: 400px;"> <!-- Segunda columna -->
                        <col style="width: 160px;"> <!-- Tercera columna -->
                        <col style="width: 130px;"> <!-- Cuarta columna -->
                        <col style="width: 60px;"> <!-- Quinta columna -->
                        <col style="width: 160px;"> <!-- Sexta columna -->
                        <col style="width: 130px;"> <!-- Séptima columna -->
                        <col style="width: 60px;"> <!-- Octava columna -->
                        <col style="width: 120px;"> <!-- Novena columna -->
                        <col style="width: 130px;"> 
                    </colgroup>
                    <thead></thead>
                    <tbody>
                        <tr>
                            <th scope="row" style="text-align: left;">NOMBRE PROYECTO:</th>
                            <td>
                                <input type="text" class="form-control form-control-sm"   value="{{ presupuesto['presupuesto_general']['proyecto'] }}" disabled id="PROYECTO" name="PROYECTO" autocomplete="off">
                            </td>
                            <th scope="row" style="text-align: left;">PRESUPUESTO CLIENTE:</th>
                            <td>
                                <input type="text"  value="{{ presupuesto['presupuesto_general']['presupuesto_cliente'] }}" class="form-control currency-input borderless" name="PRESUPUESTO_CLIENTE" id="PRESUPUESTO_CLIENTE" placeholder="$0.00" readonly>
                            </td>
                            <td>
                                <th scope="row">FALTA POR COBRAR:</th>
                            <td>
                                <input type="text"  value="{{ presupuesto['presupuesto_general']['falta_por_cobrar'] }}" class="form-control currency-input borderless" name="FALTA_COBRAR" id="FALTA_COBRAR" placeholder="$0.00">
                            </td>
                            <td>
                                <input type="text" value="%0" class="form-control currency-input borderless" id="PORCENTAJE_POR_COBRAR" placeholder="%0" name="PORCENTAJE_POR_COBRAR" style="width: 50px;">
                            </td>
                            <th scope="row">FECHA INICIO:</th>
                            <td>
                                <input type="date" name="FECHA_INICIO" class="form-control borderless" id="FECHA_INICIO">
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">DIRECCIÓN:</th>
                            <td>
                                <input type="text" class="form-control borderless" id="DIRECCION" name="DIRECCION" value="{{ presupuesto['presupuesto_general']['id_director'] }}" readonly>
                            </td>
                            <th scope="row">PAGADO CLIENTE:</th>
                            <td>
                                <input type="text" class="form-control currency-input borderless" name="PAGADO_CLIENTE" id="PAGADO_CLIENTE" value="{{ presupuesto['presupuesto_general']['pagado_cliente'] }}" readonly>
                            </td>
                            <td>
                                <input type="text" class="form-control currency-input borderless" id="PORCENTAJE_PAGADO_CLIENTE" placeholder="%0" name="PORCENTAJE_PAGADO_CLIENTE" style="width: 50px;">
                            </td>
                            <th scope="row">FALTA POR GASTAR:</th>
                            <td>
                                <input type="text" class="form-control currency-input borderless" name="FALTA_GASTAR"  id="FALTA_GASTAR"  value="{{ presupuesto['presupuesto_general']['pagado_cliente'] }}">
                            </td>
                            <td>
                                <input type="text" class="form-control currency-input borderless" id="PORCENTAJE_POR_GASTAR" placeholder="%0" name="PORCENTAJE_POR_GASTAR" style="width: 50px;">
                            </td>
                            <th scope="row">FECHA FIN:</th>
                            <td>
                                <input type="date" name="FECHA_FIN" class="form-control borderless" id="FECHA_FIN">
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">DIRECTOR:</th>
                            <td>
                                <input type="text" class="form-control borderless" id="DIRECTOR" name="DIRECTOR" value="{{ presupuesto['presupuesto_general']['id_director'] }}" readonly>
                            </td>
                            <th scope="row">GASTADO REAL:</th>
                            <td>
                                <input type="text" class="form-control currency-input borderless" name="GASTADO_REAL" id="GASTADO_REAL" value="{{ presupuesto['presupuesto_general']['gastado_real'] }}">
                            </td>
                            <td>
                                <input type="text" class="form-control currency-input borderless" name="PORCENTAJE_GASTADO" id="PORCENTAJE_GASTADO" value="{{ presupuesto['presupuesto_general']['porcentaje_gastado'] }}" name="PORCENTAJE_GASTADO" style="width: 50px;">
                            </td>
                            <th scope="row">STATUS OBRA:</th>
                            <td>
                                <input type="text" class="form-control currency-input borderless" id="ESTATUS_OBRA" name="ESTATUS_OBRA" value="{{ presupuesto['presupuesto_general']['estatus_proyecto'] }}">
                            </td>
                            <td>
                                <input type="text" class="form-control currency-input borderless" id="PORCENTAJE_ESTADO" placeholder="%0" name="PORCENTAJE_ESTADO" style="width: 50px;">
                            </td>
                            <th scope="row">TOTAL SEMANAS:</th>
                            <td>
                                <input type="text" class="form-control currency-input borderless" style="text-align: center;" id="DIAS_TOTALES" name="DIAS_TOTALES">
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
        </div>  
    </div>

    <div class="collapse" id="collapseExample">
        <div class="card card-body">
            <div class="form-group row">
                <!-- % POR COBRAR -->
                <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                    <label style="text-align: center;">% POR COBRAR</label>
                    <div class="progress" role="progressbar" aria-label="Example with label" aria-valuemin="0"
                        aria-valuemax="100">
                        <div class="progress-bar bg-success" id="progress-bar-cobrar" style="width: 25%">25%</div>
                    </div>
                </div>
                <!-- % PAGADO -->
                <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                    <label style="text-align: center;">% PAGADO</label>
                    <div class="progress" role="progressbar" aria-label="Example with label" aria-valuemin="0"
                        aria-valuemax="100">
                        <div class="progress-bar bg-success" id="progress-bar-pagado" style="width: 100%">100%</div>
                    </div>
                </div>
                <!-- % GASTADO -->
                <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                    <label style="text-align: center;">% GASTADO</label>
                    <div class="progress" role="progressbar" aria-label="Example with label" aria-valuemin="0"
                        aria-valuemax="100">
                        <div class="progress-bar bg-success" id="progress-bar-gastado" style="width: 25%">25%</div>
                    </div>
                </div>
                <!-- % POR GASTAR -->
                <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                    <label style="text-align: center;">% POR GASTAR</label>
                    <div class="progress" role="progressbar" aria-label="Example with label" aria-valuemin="0"
                        aria-valuemax="100">
                        <div class="progress-bar bg-success" id="progress-bar-gastar" style="width: 25%">25%</div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>


<br>

    <div class="container-fluid">
        <div class="card">
            <div class="card-body">
                <div class="container-fluid">
                    <br>
                    <div class="row">
                        <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                            <button class="btn botones add-row-btn"  type="button" onclick="añadirConcepto()">AGREGAR PARTIDA</button>
                        </div>
                    </div>
                    <br>
                    <!-- Contenedor donde se agregarán los modales dinámicamente -->
                    <div id="subpresupuestos">
    
                    </div>
                    <div class="table-presupuesto">
                        <table id="DETALLE_PRESUPUESTO" class="table table-hover table-borderless">
                            <colgroup>
                                <!-- Agrega más columnas según sea necesario -->
                                <col style="width: 40px;"> <!-- Primera columna -->
                                <col style="width: 350px;"> <!-- Segunda columna -->
                                <col style="width: 350px;"> <!-- Tercera columna -->
                                <col style="width: 130px;"> <!-- Cuarta columna -->
                                <col style="width: 130px;"> <!-- Quinta columna -->
                                <col style="width: 130px;"> <!-- Sexta columna -->
                                <col style="width: 90px;"> <!-- Séptima columna -->
                                <col style="width: 230px;"> <!-- Octava columna -->
                                <col style="width: 50px;"> <!-- Novena columna -->
                                <!-- Añade más columnas si es necesario -->
                            </colgroup>
                            <thead class="thead-dark" style="text-align: center;">
                                <tr>
                                    <th style="white-space: normal;word-wrap: break-word;">NO</th>
                                    <th>PARTIDA PRESUPUESTAL</th>
                                    <th>CONTRATISTA / PROVEEDOR</th>
                                    <th style="white-space: normal;word-wrap: break-word;">PRESUPUESTO CLIENTE COSTO DIRECTO IVA INC.</th>
                                    <th style="white-space: normal;word-wrap: break-word;">PRESUPUESTO CONTRATISTAS IVA INC.</th>
                                    <th style="white-space: normal;word-wrap: break-word;">DIFERENCIA PRESUPUESTOS</th>
                                    <th style="white-space: normal;word-wrap: break-word;">CONTRATO FIRMADO</th>
                                    <th>ESTATUS</th>
                                    <th></th>
                                    <!-- Agrega más encabezados si es necesario -->
                                </tr>
                            </thead>
                            <tbody>
                                {% for detalle in presupuesto['detalles_presupuesto'] %}
                                <tr>
                                    <td>{{ loop.index }}</td>
                                    <td>{{ detalle['concepto'] }}</td>
                                    <td>{{ detalle['presupuesto_cliente'] }}</td>
                                    <td>{{ detalle['presupuesto_contratista'] }}</td>
                                    <td>{{ detalle['diferencia'] }}</td>
                                    <td>{{ 'Sí' if detalle['contrato_firmado'] else 'No' }}</td>
                                    <td>{{ detalle['estatus'] }}</td>
                                </tr>
                                {% endfor %}
    
                            </tbody>
                            <tfoot>
                                <!-- Pie de tabla -->
                                <tr>
                                    <td colspan="3"class="text-end"><strong>SUBTOTAL:</strong></td>
                                    <td><input type="text" id="subtotalCliente" name="subtotalCliente" class="form-control  currency-input"
                                            placeholder="$0.00" readonly></td>
                                    <td><input type="text" id="subtotalContratista" name="subtotalContratista" class="form-control  currency-input"
                                            placeholder="$0.00" readonly></td>
                                    <td><input type="text" name="subtotalDiferencia" id="subtotalDiferencia" class="form-control  currency-input"
                                            placeholder="$0.00" readonly></td>
                                    <td colspan="3"></td>
                                </tr>
                                <tr>
                                   
                                    <td   colspan="3" class="text-end"><strong>% INDIRECTO:</strong></td>
                                    <td><input type="number" name="porcentajeIndirecto" id="porcentajeIndirecto" min='0' class="form-control"
                                            style="text-align: center;" placeholder="0"
                                            onchange="calcularTotalConIndirecto()"></td>
                                    <td colspan="5"></td>
                                </tr>
                                <tr>
                                
                                    <td  colspan="3" class="text-end"><strong>TOTAL INDIRECTO:</strong></td>
                                    <td><input type="text" id="totalIndirectoCliente" name="totalIndirectoCliente" class="form-control  currency-input"
                                            placeholder="$0.00" readonly></td>
                                    <td colspan="5"></td>
                                </tr>
                                <tr>
                                    <td colspan="3" class="text-end"><strong>TOTAL:</strong></td>
                                    <td><input type="text" id="totalCliente" name="totalCliente" class="form-control  currency-input"
                                            placeholder="$0.00" readonly></td>
                                    <td><input type="text" id="totalContratista" class="form-control  currency-input"
                                            placeholder="$0.00" readonly></td>
                                    <td><input type="text" id="totalDiferencia" class="form-control  currency-input"
                                            placeholder="$0.00" readonly></td>
                                    <td colspan="3"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <br>
    </div>
</form>
<script src="{{ url_for('static', filename='JS/funcionesAltaPresupuesto.js') }}"></script>


{% endblock %}
