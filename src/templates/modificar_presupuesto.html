{% extends "layout.html" %}
{% block title %}PRESUPUESTO{% endblock %}

{% block customCSS %}
<style>
    body {
        background-color: #d9e3eb;
    }

    .table {
        table-layout: fixed;
        width: 100%;
        border-collapse: collapse;
        position: relative;
        /* Para colocar los resizers */
    }

 

    th,
    td {
        padding: 10px;
        text-align: center;
        border: 1px solid #ddd;
    }

    /* Estilos para los resizers */
    .resizer {
        width: 5px;
        cursor: col-resize;
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        z-index: 1;
        background-color: #ddd;
        /* Color visible para el resizer */
    }

    .currency-input {
        text-align: right;
        width: 110px;
        /* Alinea el texto a la derecha para valores monetarios */
    }

    .borderless {
        border: none;
        /* Elimina los bordes de los inputs */
    }

    tfoot tr {
        background-color: #f8f9fa;
        /* Color de fondo para el pie de tabla */
    }

    tfoot td {
        padding: 10px;
        /* Espaciado interno en las celdas del pie de tabla */
    }

    th,
    td {
        padding: 10px;
        /* Espaciado interno para mejorar la legibilidad */
        text-align: center;
        /* Centra el texto de las celdas */
        border: 1px solid #ddd;
        /* Añade bordes a las celdas */
    }

    .table thead th {
        position: sticky;
        top: 0;
        background-color: #0f2d3a;
        color: #ffff;
        font-size: 12px;
        font-family: arial;
        margin: 0px;
        z-index: 2;
    }

    #DETALLE_PRESUPUESTO tfoot {
        position: sticky;
        bottom: 0;
        background-color: white;
        z-index: 2;

    }

    .form-label {
        font-family: arial;
        margin: 0px;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        display: block;

    }

    .presupuesto {
        background-color: #0f2d3a;
        color: #ffff;
        font-family: arial;
        margin: 0px;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        display: block;
    }

    .table-presupuesto  {
        max-height: 500px;
        overflow-y: auto;
        overflow-x: auto;
    }

    .table-presupuesto_sub  {
        max-height: 500px;
        overflow-y: auto;
        overflow-x: auto;
    }

    .table th,
    .table td {
        vertical-align: middle;
        white-space: nowrap;
        font-family: arial;

    }

    #heder-presupuestos th,
    #heder-presupuestos td {
        text-align: left;

    }

    .readonly-select {
    pointer-events: none; /* Deshabilita la interacción del usuario */
    background-color: #e9ecef; /* Color de fondo para el select de solo lectura */
    cursor: not-allowed; /* Cambia el cursor a no permitido */
    }

    .borderless {
        border: none;
        box-shadow: none;
        outline: none;

    }

    .xnu {
        font-family: arial;
        margin: 0px;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        display: block;
        font-size: 20px;
        font-weight: normal;
    }

    .card-header {
        font-size: 12px;
        font-family: arial;
        margin: 0px;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        display: block;

    }

    .table-borderless {
    border-collapse: collapse;
}

.table-borderless th,
.table-borderless td,
.table-borderless thead th,
.table-borderless tbody td,
.table-borderless tfoot th {
    border: none;
}

.table-borderless colgroup col {
    border: none;
}

    .modal-header{
        background-color: #0f2d3a; 
        color: #fff;
    }

    .modal-title {
        background-color: #0f2d3a; 
        color: #fff;
        font-size: 14px;
        font-family: arial;
        margin: 0px;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        display: block;

    }


    a.link {
        color: #0f2d3a;
        font-size: 12px;
        font-family: arial;
        margin: 0px;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        display: block;
    }

    .oculto {
        display: none;
    }

    @media (min-width: 1200px) {
    .modal-xl {
        --bs-modal-width: 1600px;
    }

    
}

#suggestions {
    position: absolute;
    z-index: 1000; /* Asegurar que esté encima de otros elementos */
    background: white;
    border: 1px solid #ccc;
    max-height: 50px; /* Limitar la altura si hay muchas sugerencias */
    overflow-y: auto; /* Habilitar el scroll */
  
}

#suggestions .list-group-item {
    cursor: pointer;
}

#suggestions .list-group-item:hover {
    background-color: #f0f0f0;
}

</style>
{% endblock %}

{% block titutlo %}PRESUPUESTO{% endblock %}

{% block content %}


<br>
<div class="container-fluid">
    <form class="needs-validation" novalidate accion="/edit_presupuesto?={{presupuesto['id_presupuesto']}}" method="post">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <input type="hidden" name="token" value="{{ token }}">
    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
        <div class="text-center">
            <button class="btn botones" type="submit">CONFIRMA</button>
        </div>
    </div>

    <br>

    <div class="card">
        <div class="card-body">
           
            <div class="table-responsive">
                <table class="table table-borderless heder-presupuestos">
                    <colgroup>
                        <col style="width: 150px"> <!-- Primera columna -->
                        <col style="width: 400px;"> <!-- Segunda columna -->
                        <col style="width: 160px;"> <!-- Tercera columna -->
                        <col style="width: 130px;"> <!-- Cuarta columna -->
                        <col style="width: 60px;"> <!-- Quinta columna -->
                        <col style="width: 160px;"> <!-- Sexta columna -->
                        <col style="width: 130px;"> <!-- Séptima columna -->
                        <col style="width: 60px;"> <!-- Octava columna -->
                        <col style="width: 120px;"> <!-- Novena columna -->
                        <col style="width: 130px;"> 
                    </colgroup>
                    <thead></thead>
                    <tbody>
                        <tr>
                            <th scope="row" style="text-align: left;">NOMBRE PROYECTO:</th>
                            <td>
                                <input type="text" class="form-control form-control-sm" id="PROYECTO" name="PROYECTO" value="{{ presupuesto['proyecto']}}" autocomplete="off" readonly>
                            </td>
                            <th scope="row" style="text-align: right;">PRESUPUESTO CLIENTE:</th>
                            <td>
                                <input type="text" class="form-control" name="PRESUPUESTO_CLIENTE" id="PRESUPUESTO_CLIENTE" value="{{ presupuesto['presupuesto_cliente'] }}"  style="text-align: right;width: 110px;" readonly>
                            </td>
                            <td>
                                <th scope="row" style="text-align: right;">FALTA POR COBRAR:</th>
                            <td>
                                <input type="text" class="form-control" name="FALTA_POR_COBRAR" id="FALTA_POR_COBRAR" value="{{ presupuesto['falta_por_cobrar'] }}" style="text-align: right;width: 110px;" readonly>
                            </td>
                            <td>
                                <input type="text" class="form-control" id="PORCENTAJE_POR_COBRAR" name="PORCENTAJE_POR_COBRAR" style="width: 50px; text-align: right;" value="{{ presupuesto['porcentaje_por_cobrar'] }}" readonly>
                            </td>
                            <th scope="row" style="text-align: right;">FECHA INICIO:</th>
                            <td>
                                <input type="date" name="FECHA_INICIO"  id="FECHA_INICIO" class="form-control  text-center" value="{{ presupuesto['fecha_inicio'] }}" readonly>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">DIRECCIÓN DE OBRA:</th>
                            <td>
                                <input type="text" class="form-control" id="DIRECCION" name="DIRECCION" value="{{ presupuesto['direcion_obra'] }}" readonly>
                            </td>
                            <th scope="row" style="text-align: right;">PAGADO CLIENTE:</th>
                            <td>
                                <input type="text" class="form-control" name="PAGADO_CLIENTE" id="PAGADO_CLIENTE" value="{{ presupuesto['pagado_cliente']}}" style="text-align: right;width: 110px;" readonly>
                            </td>
                            <td>
                                <input type="text" class="form-control" id="PORCENTAJE_PAGADO_CLIENTE" name="PORCENTAJE_PAGADO_CLIENTE" style="text-align: right;width: 50px;" value="{{ presupuesto['porcentaje_pagado'] }}" readonly>
                            </td>
                            <th scope="row" style="text-align: right;">FALTA POR GASTAR:</th>
                            <td>
                                <input type="text" class="form-control" name="FALTA_POR_GASTAR"  id="FALTA_POR_GASTAR" value="{{ presupuesto['falta_por_gastar'] }}" style="text-align: right;width: 110px;" readonly>
                            </td>
                            <td>
                                <input type="text" class="form-control" id="PORCENTAJE_POR_GASTAR" name="PORCENTAJE_POR_GASTAR" value="{{ presupuesto['porcentaje_por_gastar']}}" style="text-align: right;width: 50px;" readonly>
                            </td>
                            <th scope="row" style="text-align: right;">FECHA FIN:</th>
                            <td>
                                <input type="date" name="FECHA_FIN" class="form-control text-center" id="FECHA_FIN" value="{{ presupuesto['fecha_fin'] }}" readonly>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">DIRECTOR DE OBRA:</th>
                            <td>
                                <select  class="form-control" id="DIRECTOR" name="DIRECTOR" disabled>
                                    <option value=1>SELECIONA UN DIRECTOR</option>
                                </select>
                            </td>
                            <th scope="row" style="text-align: right;">GASTADO REAL:</th>
                            <td>
                                <input type="text" class="form-control" name="GASTADO_REAL" id="GASTADO_REAL" value="{{ presupuesto['gastado_real'] }}" style="text-align: right;width: 110px;" readonly>
                            </td>
                            <td>
                                <input type="text" class="form-control" name="PORCENTAJE_GASTADO_REAL" id="PORCENTAJE_GASTADO_REAL"  value="{{ presupuesto['porcentaje_gastado']}}" style="text-align: right;width: 50px;" readonly>
                            </td>
                            <th scope="row" style="text-align: right;">ESTADO DE OBRA:</th>
                            <td>
                                <input type="text" class="form-control currency-input" id="ESTATUS_OBRA" name="ESTATUS_OBRA" value="{{ presupuesto['estatus'] }}" readonly>
                            </td>
                            <td>
                                
                            </td>
                            <th scope="row" style="text-align: right;">TOTAL SEMANAS:</th>
                            <td>
                                <input type="text" class="form-control" style="text-align: center;" id="DIAS_TOTALES" name="DIAS_TOTALES" value="{{ presupuesto['total_semanas'] }}" readonly>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
        </div>  
    </div>

    <div class="collapse" id="collapseExample">
        <div class="card card-body">
            <div class="form-group row">
                <!-- % POR COBRAR -->
                <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                    <label style="text-align: center;">% POR COBRAR</label>
                    <div class="progress" role="progressbar" aria-label="Example with label" aria-valuemin="0"
                        aria-valuemax="100">
                        <div class="progress-bar bg-success" id="progress-bar-cobrar" style="width: 25%">25%</div>
                    </div>
                </div>
                <!-- % PAGADO -->
                <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                    <label style="text-align: center;">% PAGADO</label>
                    <div class="progress" role="progressbar" aria-label="Example with label" aria-valuemin="0"
                        aria-valuemax="100">
                        <div class="progress-bar bg-success" id="progress-bar-pagado" style="width: 100%">100%</div>
                    </div>
                </div>
                <!-- % GASTADO -->
                <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                    <label style="text-align: center;">% GASTADO</label>
                    <div class="progress" role="progressbar" aria-label="Example with label" aria-valuemin="0"
                        aria-valuemax="100">
                        <div class="progress-bar bg-success" id="progress-bar-gastado" style="width: 25%">25%</div>
                    </div>
                </div>
                <!-- % POR GASTAR -->
                <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                    <label style="text-align: center;">% POR GASTAR</label>
                    <div class="progress" role="progressbar" aria-label="Example with label" aria-valuemin="0"
                        aria-valuemax="100">
                        <div class="progress-bar bg-success" id="progress-bar-gastar" style="width: 25%">25%</div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>


<br>
<div class="card">
    <div class="card-body">
        <div class="container-fluid">
            <br>
            <div class="row">
                <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                    <button class="btn botones add-row-btn"  type="button" onclick="añadirConcepto()">AGREGAR PARTIDA</button>
                </div>
            </div>
            <br>
            <!-- Contenedor donde se agregarán los modales dinámicamente -->
            <div id="subpresupuestos">

            </div>
            <div class="table-presupuesto">
                <table id="DETALLE_PRESUPUESTO" class="table table-hover table-borderless">
                    <colgroup>
                        <!-- Agrega más columnas según sea necesario -->
                        <col style="width: 40px;"> <!-- Primera columna -->
                        <col style="width: 350px;"> <!-- Segunda columna -->
                        <col style="width: 350px;"> <!-- Tercera columna -->
                        <col style="width: 130px;"> <!-- Cuarta columna -->
                        <col style="width: 130px;"> <!-- Quinta columna -->
                        <col style="width: 130px;"> <!-- Sexta columna -->
                        <col style="width: 90px;"> <!-- Séptima columna -->
                        <col style="width: 230px;"> <!-- Octava columna -->
                        <col style="width: 50px;"> <!-- Novena columna -->
                        <!-- Añade más columnas si es necesario -->
                    </colgroup>
                    <thead class="thead-dark" style="text-align: center;">
                        <tr>
                            <th style="white-space: normal;word-wrap: break-word;">NO</th>
                            <th>PARTIDA PRESUPUESTAL</th>
                            <th>CONTRATISTA / PROVEEDOR</th>
                            <th style="white-space: normal;word-wrap: break-word;">PRESUPUESTO CLIENTE COSTO DIRECTO IVA INC.</th>
                            <th style="white-space: normal;word-wrap: break-word;">PRESUPUESTO CONTRATISTAS IVA INC.</th>
                            <th style="white-space: normal;word-wrap: break-word;">DIFERENCIA PRESUPUESTOS</th>
                            <th style="white-space: normal;word-wrap: break-word;">CONTRATO FIRMADO</th>
                            <th>ESTATUS</th>
                            <th></th>
                            <!-- Agrega más encabezados si es necesario -->
                        </tr>
                    </thead>
                    <tbody>
                        {% for detalle in presupuesto['detalle_presupuesto'] %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>
                                <input type="text" class="form-control borderless text-center" style="display: none" id="ID_DETALLE_{{loop.index}}" name="ID_DETALLE[]" value="{{detalle['id']}}" readonly="">
                                <input type="text" class="form-control" id="INPUT_ESPECIALIDADES_{{loop.index}}" value="{{detalle['concepto']}}" name="ESPECIALIDADES_DB[]" autocomplete="off" disabled>
                                <input type="text" class="form-control" style="display: none" id="INPUT_ID_ESPECIALIDADES" name="ID_ESPECIALIDADES[]">
                                <div class="autocomplete-items"></div>
                                <div class="invalid-feedback">
                                    Selecciona una especialidad
                                </div>
                            </td>

                            {% if detalle['id_proveedor'] == 0 %}
                            <td style="text-align: center;">
                                <button type="button" class="btn botones" id="boto_modal_subpresupuesto_{{loop.index}}" data-bs-toggle="modal" data-bs-target="#modalPresupuesto_{{loop.index}}">
                                    VER PRESUPUESTO BAUART
                                </button>
                                <select class="form-control" id="INPUT_PROVEEDOR_{{loop.index}}" name="PROVEEDOR_DB[]" onchange="sub_presupuesto(this,1)" style="display: none;">
                                    <option value="0">SELECIONA UN PROVEEDOR</option>
                                </select>
                            </td>
                            {% else %}
                            <td>
                                <select class="form-control" id="INPUT_PROVEEDOR_{{loop.index}}" name="PROVEEDOR_DB[]" onchange="sub_presupuesto(this,1)">
                                    <option value="">SELECIONA UN PROVEEDOR</option>
                                    {% for p in proveedores%}
                                        <option value="{{p.id}}" {{ 'selected' if detalle['id_proveedor'] == p.id else '' }}>{{p.razon_social}}</option>
                                    {% endfor%}
                                </select>
                            </td>

                            {%endif%}
                            
                            <td>
                                <input type="text" class="form-control currency-input presupuesto-cliente" id="PRESUPUESTO_CLIENTE_{{loop.index}}" name="PRESUPUESTO_CLIENTE_DB[]" value="{{ detalle['presupuesto_cliente'] }}" onchange="concular_diferecnia()">
                            </td>
                            <td>
                                <input type="text" class="form-control currency-input presupuesto-proveedor" id="PRESUPUESTO_PROVEEDOR_{{loop.index}}" name="PRESUPUESTO_PROVEEDOR_DB[]" value="{{ detalle['presupuesto_contratista'] }}" onchange="concular_diferecnia()">
                            </td>
                            <td>
                                <input type="text" class="form-control currency-input presupuesto-diferencia" id="DIFERENCIA_{{loop.index}}" name="DIFERENCIA_DB[]" onchange="concular_diferencia()" value="{{ detalle['diferencia'] }}" readonly="">
                            </td>
                           
                            {% if detalle['id_proveedor'] == 0 %}
                            <td>
                                <select style="text-align: center;" id="CONTRATO_FIRMADO" name="CONTRATO_FIRMADO_DB[]" class="form-control readonly-select">
                                    <option value=1 {{ 'selected' if detalle['contrato_firmado'] == 0 else '' }}>SÍ</option>
                                    <option value=0 {{ 'selected' if detalle['contrato_firmado'] == 1 else '' }}>NO</option>
                                </select>
                            </td>
                            <td>
                                <select id="STATUS_{{loop.index}}" name="STATUS_DB[]" class="form-control readonly-select">
                                    <option value=0 {{ 'selected' if  detalle['estatus'] == 0 else '' }}>PRESUPUESTO CARGADO</option>
                                    <option value=1 {{ 'selected' if  detalle['estatus'] == 1 else '' }}>APROBADO POR DIRECTOR</option>
                                </select>
                            </td>
                            {% else %}
                            <td>
                                <select style="text-align: center;" id="CONTRATO_FIRMADO" name="CONTRATO_FIRMADO_DB[]" class="form-control">
                                    <option value=1 {{ 'selected' if detalle['contrato_firmado'] == 0 else '' }}>SÍ</option>
                                    <option value=0 {{ 'selected' if detalle['contrato_firmado'] == 1 else '' }}>NO</option>
                                </select>
                            </td>
                            <td>
                                <select id="STATUS_{{loop.index}}" name="STATUS_DB[]" class="form-control">
                                    <option value=0 {{ 'selected' if  detalle['estatus'] == 0 else '' }}>PRESUPUESTO CARGADO</option>
                                    <option value=1 {{ 'selected' if  detalle['estatus'] == 1 else '' }}>APROBADO POR DIRECTOR</option>
                                </select>
                            </td>
                            {%endif%}
                           
                            
                            <td> 
                                <div class="d-flex align-items-center justify-content-center">
                                    <button type="button" onclick="eliminarFila(this)" class="btn"><i class="bi bi-trash"></i></button>
                                  </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>    

                    <tfoot>
                        <!-- Pie de tabla -->
                        <tr>
                            <td colspan="3"class="text-end"><strong>SUBTOTAL:</strong></td>
                            <td><input type="text" id="subtotalCliente" name="subtotalCliente" class="form-control" value="{{presupuesto['subtotal_cliente_iva']}}"  style="width: 110px; text-align: right;" readonly></td>
                            <td><input type="text" id="subtotalContratista" name="subtotalContratista" class="form-control" value="{{ presupuesto['sub_proveedor']}}" style="width: 110px; text-align: right;" readonly></td>
                            {% if presupuesto['diferencia_es_negativa'] %}
                                <td><input type="text" name="subtotalDiferencia" id="subtotalDiferencia" class="form-control" value="{{ presupuesto['sub_diferencia'] }}" style="width: 110px; text-align: right;  background-color: red;color: white;" readonly></td>
                            {% else %}
                            <td><input  type="text" name="subtotalDiferencia" id="subtotalDiferencia" class="form-control" value="{{ presupuesto['sub_diferencia'] }}" style="width: 110px; text-align: right;" readonly></td>

                            {%endif%}
                            <td colspan="3"></td>
                        </tr>
                        <tr>
                           
                            <td   colspan="3" class="text-end"><strong>% INDIRECTO:</strong></td>
                            <td><input type="number"  name="porcentajeIndirecto" id="porcentajeIndirecto" min="0" max="25" class="form-control"
                                    style="text-align: center;width: 110px;" value="{{ presupuesto['porcentaje_indirecto'] }}" placeholder="0"
                                    onchange="calcularTotalConIndirecto()"></td>
                            <td colspan="5"></td>
                        </tr>
                        <tr>
                        
                            <td  colspan="3" class="text-end"><strong>TOTAL INDIRECTO:</strong></td>
                            <td><input type="text" id="totalIndirectoCliente" name="totalIndirectoCliente" class="form-control currency-input"
                                    placeholder="$0.00" value="{{presupuesto['indirecto_cliente_iva']}}" readonly></td>
                            <td colspan="5"></td>
                        </tr>
                        <tr>
                            <td colspan="3" class="text-end"><strong>TOTAL:</strong></td>
                            <td><input type="text" id="totalCliente" name="totalCliente" class="form-control currency-input" value="{{presupuesto['total_cliente_iva']}}"
                                    placeholder="$0.00" readonly></td>
                            <td><input type="text" id="totalContratista"  name="totalContratista" value="{{ presupuesto['total_proveedor']}}"  class="form-control  currency-input"
                                    placeholder="$0.00" readonly></td>
                            <td><input type="text" id="totalDiferencia" name="totalDiferencia" value="{{presupuesto['total_diferencia']}}" class="form-control  currency-input"
                                    placeholder="$0.00" readonly></td>
                            <td colspan="3"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
</div>
<br>
   
<!--MODAL PRESUPUESTO BAUART-->
{% for detalle in presupuesto['detalle_presupuesto'] %}
{% set indice_detalle = loop.index %}
{% if detalle['id_proveedor'] == 0 and detalle['presupuesto_bauart'] %}
<div class="modal fade modal-xl" id="modalPresupuesto_{{loop.index}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true"  data-bs-backdrop="static"  data-bs-keyboard="false">
  <div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header">
            <h4 class="modal-title" id="exampleModalLabel">PRESUPUESTO BAUART</h4>
        </div>
        <div class="modal-body">
            <div class="form-group row">
              
                <!-- PROYECTO -->
                <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                    <strong><span id="PROYECTO_SUBPRESUPUESTO">{{presupuesto['proyecto']}}</span></strong> 
                    <input type="text"  class="form-control oculto" id="INPUT_NOMBRE_DIRECTOR_{{loop.index}}" readonly>
                </div>
            </div>
            <div class="form-group row">
                <!--DIRECION DE OBRA-->
                <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                    <strong><span id="DIRECCION_${id}">{{presupuesto['direcion_obra']}} </span></strong> 
                    <input type="text"  class="form-control oculto" id="INPUT_DIRECCION_{{loop.index}}" readonly>
                </div> 
            </div>
            <div class="form-group row">
                <!-- DIRECTOR -->
                <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                    <strong><span id="NOMBRE_DIRECTOR_${id}"></span></strong> 
                    <input type="text"  class="form-control oculto" id="INPUT_NOMBRE_DIRECTOR_{{loop.index}}" readonly>
                </div>
            </div>
            <div class="form-group row">
                <!-- PRESUPUESTO -->
                <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                    <strong><span id="NOMBRE_PRESUPUESTO_{{loop.index}}">{{detalle['presupuesto_bauart']['nombre_presupuesto']}} </span></strong> 
                    <input type="text" class="form-control" name="ID_DETALLE_BUART_DB[]" value="{{detalle['presupuesto_bauart']['id']}}" style="display: none;">                                   
                    <input type="text"  class="form-control oculto" id="INPUT_NOMBRE_PREPUSPUESTO_{{loop.index}}" readonly>
                </div>
            </div>
            <div class="container-fluid">
                <br>
                <div class="d-grid gap-2 d-md-flex justify-content-start">
                    <button type="button" class="btn botones add-row-btn" onclick="añadir_concepto_sub('{{loop.index}}',false)">AGREGAR PARTIDA</button>
                    
                    <button type="button" class="btn boton-nomina add-row-btn" onclick="añadir_concepto_sub('{{loop.index}}',true)">AGREGAR NOMINA</button>
                    
                </div>
                
                <br>
                <input type="text" class="form-control oculto" name="ID_PARTIDA_DB[]" value="{{indice_detalle}}" >
                <div class="table-presupuesto_sub">
                    <table id="tablasub_{{indice_detalle}}" class="table tabla-subpresupuesto table-hover table-borderless">
                        <colgroup>
                            <!-- Agrega más columnas según sea necesario -->
                            <col style="width: 40px;"> <!-- Primera columna -->
                            <col style="width: 400px;"> <!-- Segunda columna -->
                            <col style="width: 200px;"> <!-- Tercera columna -->
                            <col style="width: 130px;"> <!-- Cuarta columna -->
                            <col style="width: 130px;"> <!-- Quinta columna -->
                            <col style="width: 130px;"> <!-- Sexta columna -->
                            <col style="width: 200px;"> <!-- Novena columna -->
                            <col style="width: 50px;">
                            <!-- Añade más columnas si es necesario -->
                        </colgroup>
                        <thead class="thead-dark" style="text-align: center;">
                            <tr>
                                <th style="white-space: normal;word-wrap: break-word;">NO</th>
                                <th>PARTIDA PRESUPUESTAL</th>
                                <th>CONTRATISTA / PROVEEDOR</th>
                                <th  style="white-space: normal;word-wrap: break-word;">PRESUPUESTO CLIENTE COSTO DIRECTO IVA INC.</th>
                                <th  style="white-space: normal;word-wrap: break-word;">PRESUPUESTO CONTRATISTAS IVA INC.</th>
                                <th  style="white-space: normal;word-wrap: break-word;">DIFERENCIA PRESUPUESTOS</th>
                                <th>ESTATUS</th>
                                <th></th>
                                <!-- Agrega más encabezados si es necesario -->
                            </tr>
                        </thead>
                        <tbody>
                            
                            {% for subdetalle in detalle['presupuesto_bauart']['detalles'] %}
                            {% set indice_subdetalle = loop.index %}
                            <tr>

                                <td>{{loop.index}}</td>
                                {% if subdetalle['is_nomina'] %}
                                <td>
                                    <input type="text" class="form-control oculto" name="ID_DETALLE_SUB_BUART_DB[]" value="{{subdetalle['id']}}" > 
                                    <input type="text" class="form-control sub_concepto" id="INPUT_ESPECIALIDADES_SUB_{{indice_detalle}}-{{loop.index}}" oninput="autocompleta_concepto_sub_modificar(this,'{{indice_detalle}}','{{loop.index}}',true)" name="ESPECIALIDADES_SUB_DB[]" value="{{ subdetalle['concepto'] }}" autocomplete="off" required="">
                                    <input type="text" class="form-control" style="display: none" id="INPUT_ID_ESPECIALIDADES_SUB_{{indice_detalle}}-{{loop.index}}" name="INPUT_ID_ESPECIALIDADES_SUB_DB[]" value="{{ subdetalle['id_concepto'] }}">
                                    <input type="text" class="form-control" style="display: none" id="IS_NOMINA_{{indice_detalle}}-{{loop.index}}[]" value="1" name="IS_NOMINA_SUB_DB[]">
                                    <div class="autocomplete-items" id="DIV_LISTA_RESULTADOS_{{indice_detalle}}-{{loop.index}}"></div>
                                    <div class="invalid-feedback">
                                        SELECIONA UN CONCEPTO
                                    </div>
                                </td>
                                <td>
                                    <select class="form-control" onchange="colocarSueldo(this,'{{indice_subdetalle}}','{{indice_detalle}}')" id="SELECT_PROVEEDOR_SUB_{{indice_detalle}}-{{loop.index}}" name="PROVEEDOR_SUB_DB[]">
                                    
                                        {% for p in puestos %}
                                        <option value="{{ p.id}}"  {{ 'selected' if p.id_concepto == p.id else '' }} >
                                            {{ p.puesto }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </td>
                                <td>
                                    <input type="text" class="form-control currency-input presupuesto-cliente" id="SUB_PRESUPUESTO_CLIENTE-{{indice_detalle}}-{{loop.index}}"  name="SUB_PRESUPUESTO_CLIENTE_DB[]" value="{{ subdetalle['presupuesto_cliente'] }}" placeholder="$0.00" onchange="sub_cular_diferecnia('{{indice_detalle}}','{{loop.index}}')">
                                    
                                </td>
                                <td>
                                    <input type="text" class="form-control currency-input presupuesto-proveedor" id="SUB_PRESUPUESTO_PROVEEDOR-{{indice_detalle}}-{{loop.index}}" name="SUB_PRESUPUESTO_PROVEEDOR_DB[]" value="{{ subdetalle['presupuesto_contratista'] }}" onchange="sub_cular_diferecnia('{{indice_detalle}}','{{loop.index}}')">
                                </td>
                                <td>
                                    <input type="text" class="form-control currency-input presupuesto-diferencia" value="{{ subdetalle['diferencia'] }}" name="SUB_DIFERENCIA_DB[]" readonly>
                                </td>
                                <td>
                                    <select id="STATUS" name="STATUS_SUB_DB[]"  class="form-control">
                                        <option value=0 {{ 'selected' if  subdetalle['estatus'] == 0 else '' }}>PRESUPUESTO CARGADO</option>
                                        <option value=1 {{ 'selected' if  subdetalle['estatus'] == 1 else '' }}>APROBADO POR DIRECTOR</option>
                                    </select>
                                </td>
                                <td class="d-flex align-items-center justify-content-center">
                                
                                    <button type="button" onclick="eliminarFila(this)" class="btn"><i class="bi bi-trash"></i></button>
                                    
                                </td>
                                {% else %}
                                <td>    
                                    <input type="text" class="form-control oculto" name="ID_DETALLE_SUB_BUART_DB[]" value="{{subdetalle['id']}}" > 
                                    <input type="text" class="form-control sub_concepto" id="INPUT_ESPECIALIDADES_SUB_{{indice_detalle}}-{{loop.index}}" oninput="autocompleta_concepto_sub_modificar(this,'{{indice_detalle}}','{{loop.index}}',false)" name="ESPECIALIDADES_SUB_DB[]" value="{{ subdetalle['concepto'] }}" autocomplete="off" required="">
                                    <input type="text" class="form-control" style="display: none" id="INPUT_ID_ESPECIALIDADES_SUB_{{indice_detalle}}-{{loop.index}}" name="INPUT_ID_ESPECIALIDADES_SUB_DB[]" value="{{ subdetalle['id_concepto'] }}">
                                    <input type="text" class="form-control" style="display: none" id="IS_NOMINA_{{indice_detalle}}-{{loop.index}}[]"  value="1">
                                    <div class="autocomplete-items" id="DIV_LISTA_RESULTADOS_{{indice_detalle}}-{{loop.index}}"></div>
                                    <div class="invalid-feedback">
                                        SELECIONA UN CONCEPTO
                                    </div>
                                </td>
                                <td>
                                    <select class="form-control" id="SELECT_PROVEEDOR_SUB_{{indice_detalle}}-{{loop.index}}" name="PROVEEDOR_SUB_DB[]" readonly>
                                        <option value=0  style="text-align: center;">SELECIONA UN PROVEEDOR</option>
                                    </select>
                                </td>
                                <td>
                                    <input type="text" class="form-control currency-input presupuesto-cliente" id="SUB_PRESUPUESTO_CLIENTE-{{indice_detalle}}-{{loop.index}}" name="SUB_PRESUPUESTO_CLIENTE_DB[]" value="{{ subdetalle['presupuesto_cliente'] }}" placeholder="$0.00" onchange="sub_cular_diferecnia('{{indice_detalle}}','{{loop.index}}')">
                                    
                                </td>
                                <td>
                                    <input type="text" class="form-control currency-input presupuesto-proveedor" id="SUB_PRESUPUESTO_PROVEEDOR-{{indice_detalle}}-{{loop.index}}" name="SUB_PRESUPUESTO_PROVEEDOR_DB[]" value="{{ subdetalle['presupuesto_contratista'] }}" onchange="sub_cular_diferecnia('{{indice_detalle}}','{{loop.index}}')">
                                </td>
                                <td>
                                    <input type="text" class="form-control currency-input presupuesto-diferencia" id="SUB_DIFERENCIA-{{indice_detalle}}-{{loop.index}}" name="SUB_DIFERENCIA_DB[]" value="{{ subdetalle['diferencia'] }}" readonly="">
                                </td>
                                <td>
                                    <select id="STATUS" name="STATUS_SUB_DB[]" class="form-control">
                                        <option value=0 {{ 'selected' if  subdetalle['estatus'] == 0 else '' }}>PRESUPUESTO CARGADO</option>
                                        <option value=1 {{ 'selected' if  subdetalle['estatus'] == 1 else '' }}>APROBADO POR DIRECTOR</option>
                                    </select>
                                </td>
                                <td>
                                    <div class="d-flex align-items-center justify-content-center">
                                        <button type="button" onclick="eliminarFila(this)" class="btn"><i class="bi bi-trash"></i></button>
                                    </div>
                                </td>
                                {% endif %}
                                
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot>
                            <!-- Pie de tabla -->
                            
                                <tr>
                                <td colspan="2"></td>
                                <td  class="text-end"><strong>SUBTOTAL:</strong></td>
                                <td><input type="text" id="INPUT_PRESUPUESTO_CLIENTE_BAUART_{{loop.index}}" value="{{detalle['presupuesto_bauart']['total_presupuesto_cliente']}}"  name="INPUT_PRESUPUESTO_CLIENTE_BAUART_DB[]" class="form-control  currency-input" readonly></td>
                                <td><input type="text" id="INPUT_PRESUPUESTO_CONTRATISTA_{{loop.index}}"  name="INPUT_PRESUPUESTO_CONTRATISTA_BAUART_DB[]" value="{{detalle['presupuesto_bauart']['total_presupuesto_proveedor']}}" class="form-control  currency-input" readonly></td>
                                <td><input type="text" id="INPUT_DIFERENCIA_PRESUPUESTOS_{{loop.index}}" name="INPUT_DIFERENCIA_PRESUPUESTOS_BUART_DB[]" class="form-control  currency-input" value="{{detalle['presupuesto_bauart']['diferencia_presupuesto']}}" readonly></td>
                                <td colspan="1"></td>
                            </tr>
            
                    </table>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <div class="d-grid gap-2 d-md-flex justify-content-start">
            <button type="button" class="btn botones"  data-bs-dismiss="modal" onclick="guardar_presuouesto('{{indice_detalle}}')" ><i class="bi bi-floppy"></i> CONFIRMAR</button>
            </div>
        </div>
    </div>
  </div>
</div>
{% endif %}
{%endfor%}
</form>
<script src="{{ url_for('static', filename='JS/funciones_modificar_presupuesto.js') }}"></script>


{% endblock %}
