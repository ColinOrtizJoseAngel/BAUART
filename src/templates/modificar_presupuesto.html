{% extends "layout.html" %}
{% block title %}MODIFICAR PRESUPUESTO{% endblock %}

{% block customCSS %}
<style>
    body {
        background-color: #d9e3eb;
    }

    .table {
        table-layout: fixed;
        width: 100%;
        border-collapse: collapse;
        position: relative;
        /* Para colocar los resizers */
    }

 

    th,
    td {
        padding: 10px;
        text-align: center;
        border: 1px solid #ddd;
    }

    /* Estilos para los resizers */
    .resizer {
        width: 5px;
        cursor: col-resize;
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        z-index: 1;
        background-color: #ddd;
        /* Color visible para el resizer */
    }

    .currency-input {
        text-align: right;
        width: 110px;
        /* Alinea el texto a la derecha para valores monetarios */
    }

    .borderless {
        border: none;
        /* Elimina los bordes de los inputs */
    }

    tfoot tr {
        background-color: #f8f9fa;
        /* Color de fondo para el pie de tabla */
    }

    tfoot td {
        padding: 10px;
        /* Espaciado interno en las celdas del pie de tabla */
    }

    th,
    td {
        padding: 10px;
        /* Espaciado interno para mejorar la legibilidad */
        text-align: center;
        /* Centra el texto de las celdas */
        border: 1px solid #ddd;
        /* Añade bordes a las celdas */
    }

    .table thead th {
        position: sticky;
        top: 0;
        background-color: #0f2d3a;
        color: #ffff;
        font-size: 12px;
        font-family: arial;
        margin: 0px;
        z-index: 2;
    }

    #DETALLE_PRESUPUESTO tfoot {
        position: sticky;
        bottom: 0;
        background-color: white;
        z-index: 2;

    }

    .form-label {
        font-family: arial;
        margin: 0px;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        display: block;

    }

    .presupuesto {
        background-color: #0f2d3a;
        color: #ffff;
        font-family: arial;
        margin: 0px;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        display: block;
    }

    .table-presupuesto  {
        max-height: 500px;
        overflow-y: auto;
        overflow-x: auto;
    }

    .table-presupuesto_sub  {
        max-height: 500px;
        overflow-y: auto;
        overflow-x: auto;
    }

    .table th,
    .table td {
        vertical-align: middle;
        white-space: nowrap;
        font-family: arial;

    }

    #heder-presupuestos th,
    #heder-presupuestos td {
        text-align: left;

    }


    .borderless {
        border: none;
        box-shadow: none;
        outline: none;

    }

    .xnu {
        font-family: arial;
        margin: 0px;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        display: block;
        font-size: 20px;
        font-weight: normal;
    }

    .card-header {
        font-size: 12px;
        font-family: arial;
        margin: 0px;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        display: block;

    }

    .table-borderless {
    border-collapse: collapse;
}

.table-borderless th,
.table-borderless td,
.table-borderless thead th,
.table-borderless tbody td,
.table-borderless tfoot th {
    border: none;
}

.table-borderless colgroup col {
    border: none;
}

    .modal-header{
        background-color: #0f2d3a; 
        color: #fff;
    }

    .modal-title {
        background-color: #0f2d3a; 
        color: #fff;
        font-size: 14px;
        font-family: arial;
        margin: 0px;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        display: block;

    }


    a.link {
        color: #0f2d3a;
        font-size: 12px;
        font-family: arial;
        margin: 0px;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        display: block;
    }

    .oculto {
        display: none;
    }

    @media (min-width: 1200px) {
    .modal-xl {
        --bs-modal-width: 1600px;
    }

    
}

#suggestions {
    position: absolute;
    z-index: 1000; /* Asegurar que esté encima de otros elementos */
    background: white;
    border: 1px solid #ccc;
    max-height: 50px; /* Limitar la altura si hay muchas sugerencias */
    overflow-y: auto; /* Habilitar el scroll */
  
}

#suggestions .list-group-item {
    cursor: pointer;
}

#suggestions .list-group-item:hover {
    background-color: #f0f0f0;
}

</style>
{% endblock %}

{% block titutlo %}MODIFICAR PRESUPUESTO{% endblock %}

{% block content %}

<!--MODAL PARA PRESUPUESTO BAUART-->
<div class="modal fade modal-xl" id="M" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="exampleModalLabel">PRESUPUESTO BAUART</h4>
          <button type="button" style="background-color: white;" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="form-group row">
              <!-- PROYECTO -->
              <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                  <strong><span id="PROYECTO_SUBPRESUPUESTO"> </span></strong> 
                   <input type="text"  class="form-control oculto" id="INPUT_NOMBRE_DIRECTOR_${id}" readonly>
              </div>
          </div>
          <div class="form-group row">
              <!--DIRECION DE OBRA-->
              <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                  <strong><span id="DIRECCION_${id}"> </span></strong> 
                  <input type="text"  class="form-control oculto" id="INPUT_DIRECCION_${id}" readonly>
              </div> 
          </div>
          <div class="form-group row">
              <!-- DIRECTOR -->
              <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                  <strong><span id="NOMBRE_DIRECTOR_${id}"> </span></strong> 
                  <input type="text"  class="form-control oculto" id="INPUT_NOMBRE_DIRECTOR_${id}" readonly>
              </div>
          </div>
          <div class="form-group row">
              <!-- PRESUPUESTO -->
              <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                   <strong><span id="NOMBRE_PRESUPUESTO_${id}"> </span></strong> 
                  <input type="text"  class="form-control oculto" id="INPUT_NOMBRE_PREPUSPUESTO_${id}" name="NOMBRE_SUB-${id}" readonly>
              </div>
          </div>
          <div class="container-fluid">
              <br>
              <div class="d-grid gap-2 d-md-flex justify-content-start">
                <button type="button" class="btn botones add-row-btn" onclick="añadir_concepto_sub(${id},false)">AGREGAR PARTIDA</button>
                
                <button type="button" class="btn boton-nomina add-row-btn" onclick="añadir_concepto_sub(${id},true)">AGREGAR NOMINA</button>
                
              </div>
              
              <br>
              <div class="table-presupuesto_sub">
                  <table id="tablasub_${id}" class="table tabla-subpresupuesto table-hover table-borderless">
                      <colgroup>
                          <!-- Agrega más columnas según sea necesario -->
                          <col style="width: 40px;"> <!-- Primera columna -->
                          <col style="width: 500px;"> <!-- Segunda columna -->
                          <col style="width: 500px;"> <!-- Tercera columna -->
                          <col style="width: 130px;"> <!-- Cuarta columna -->
                          <col style="width: 130px;"> <!-- Quinta columna -->
                          <col style="width: 130px;"> <!-- Sexta columna -->
                          <col style="width: 50px;"> <!-- Novena columna -->
                          <!-- Añade más columnas si es necesario -->
                      </colgroup>
                      <thead class="thead-dark" style="text-align: center;">
                          <tr>
                              <th style="white-space: normal;word-wrap: break-word;">NO</th>
                              <th>PARTIDA PRESUPUESTAL</th>
                              <th>CONTRATISTA / PROVEEDOR</th>
                              <th  style="white-space: normal;word-wrap: break-word;">PRESUPUESTO CLIENTE COSTO DIRECTO IVA INC.</th>
                              <th  style="white-space: normal;word-wrap: break-word;">PRESUPUESTO CONTRATISTAS IVA INC.</th>
                              <th  style="white-space: normal;word-wrap: break-word;">DIFERENCIA PRESUPUESTOS</th>
                              <th></th>
                              <!-- Agrega más encabezados si es necesario -->
                          </tr>
                      </thead>
                      <tbody>
                          
                      </tbody>
                      <tfoot>
                          <!-- Pie de tabla -->
                          
                          <tr>
                              <td colspan="2"></td>
                              <td  class="text-end"><strong>SUBTOTAL:</strong></td>
                              <td><input type="text" id="INPUT_PRESUPUESTO_CLIENTE_BAUART_${id}"  name="INPUT_PRESUPUESTO_CLIENTE_BAUART-${id}" class="form-control  currency-input" readonly></td>
                              <td><input type="text" id="INPUT_PRESUPUESTO_CONTRATISTA_${id}"  name="INPUT_PRESUPUESTO_CONTRATISTA_BAUART-${id}" class="form-control  currency-input" readonly></td>
                              <td><input type="text" id="INPUT_DIFERENCIA_PRESUPUESTOS_${id}" name="INPUT_DIFERENCIA_PRESUPUESTOS-${id}" class="form-control  currency-input" readonly></td>
                              <td colspan="1"></td>
                          </tr>
          
                  </table>
              </div>
          </div>
        </div>
       <div class="modal-footer">
          <div class="d-grid gap-2 d-md-flex justify-content-start">
            <button type="button" class="btn botones" data-bs-dismiss="modal"><i class="bi bi-x-lg"></i> CERRAR</button>
            <button type="button" class="btn botones"  data-bs-dismiss="modal" onclick="guardar_presuouesto(${id})" ><i class="bi bi-floppy"></i> CONFIRMAR</button
          </div>
        </div>
      </div>
    </div>
  </div>
  
<!--FIN  MODAL  PARA PRESUPUESTO BAUART-->



<br>
<div class="container-fluid">
    <form class="needs-validation" novalidate accion="/Presupuestos" method="post">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <input type="hidden" name="token" value="{{ token }}">
    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
        <div class="text-center">
            <button class="btn botones" type="submit">CONFIRMA</button>
        </div>
    </div>

    <br>

    <div class="card mb-3">
        <div class="card-body">
           
            <div class="table-responsive">
                <table class="table table-borderless heder-presupuestos">
                    <colgroup>
                        <col style="width: 150px"> <!-- Primera columna -->
                        <col style="width: 400px;"> <!-- Segunda columna -->
                        <col style="width: 160px;"> <!-- Tercera columna -->
                        <col style="width: 130px;"> <!-- Cuarta columna -->
                        <col style="width: 60px;"> <!-- Quinta columna -->
                        <col style="width: 160px;"> <!-- Sexta columna -->
                        <col style="width: 130px;"> <!-- Séptima columna -->
                        <col style="width: 60px;"> <!-- Octava columna -->
                        <col style="width: 120px;"> <!-- Novena columna -->
                        <col style="width: 130px;"> 
                    </colgroup>
                    <thead></thead>
                    <tbody>
                        <tr>
                            <th scope="row" style="text-align: left;">NOMBRE PROYECTO:</th>
                            <td>
                            </td>
                                <input type="text" class="form-control form-control-sm"   value="{{ presupuesto['proyecto'] }} disabled id="PROYECTO" name="PROYECTO" autocomplete="off">
                            <th scope="row" style="text-align: left;">PRESUPUESTO CLIENTE:</th>
                            <td>
                                <input type="text"  value="{{ presupuesto['presupuesto_cliente'] }}" class="form-control currency-input borderless" name="PRESUPUESTO_CLIENTE" id="PRESUPUESTO_CLIENTE" placeholder="$0.00" readonly>
                            </td>
                            <td>
                                <th scope="row">FALTA POR COBRAR:</th>
                            <td>
                                <input type="text"   value="{{ presupuesto['falta_por_cobrar'] }}" class="form-control currency-input borderless" name="FALTA_COBRAR" id="FALTA_COBRAR" placeholder="$0.00">
                            </td>
                            <td>
                                <input type="text" value="%0" class="form-control currency-input borderless" id="PORCENTAJE_POR_COBRAR" placeholder="%0" name="PORCENTAJE_POR_COBRAR" style="width: 50px;">
                            </td>
                            <th scope="row">FECHA INICIO:</th>
                            <td>
                                <input type="date" name="FECHA_INICIO" class="form-control borderless" id="FECHA_INICIO">
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">DIRECCIÓN:</th>
                            <td>
                                <input type="text" class="form-control borderless" id="DIRECCION" name="DIRECCION" value="{{ presupuesto['id_director'] }}" readonly>
                            </td>
                            <th scope="row">PAGADO CLIENTE:</th>
                            <td>
                                <input type="text" class="form-control currency-input borderless" name="PAGADO_CLIENTE" id="PAGADO_CLIENTE" value="{{ presupuesto['pagado_cliente'] }}" readonly>
                            </td>
                            <td>
                                <input type="text" class="form-control currency-input borderless" id="PORCENTAJE_PAGADO_CLIENTE" placeholder="%0" name="PORCENTAJE_PAGADO_CLIENTE" style="width: 50px;">
                            </td>
                            <th scope="row">FALTA POR GASTAR:</th>
                            <td>
                                <input type="text" class="form-control currency-input borderless" name="FALTA_GASTAR"  id="FALTA_GASTAR"  value="{{ presupuesto['pagado_cliente'] }}">
                            </td>
                            <td>
                                <input type="text" class="form-control currency-input borderless" id="PORCENTAJE_POR_GASTAR" placeholder="%0" name="PORCENTAJE_POR_GASTAR" style="width: 50px;">
                            </td>
                            <th scope="row">FECHA FIN:</th>
                            <td>
                                <input type="date" name="FECHA_FIN" class="form-control borderless" id="FECHA_FIN">
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">DIRECTOR:</th>
                            <td>
                                <input type="text" class="form-control borderless" id="DIRECTOR" name="DIRECTOR" value="{{ presupuesto['id_director'] }}" readonly>
                            </td>
                            <th scope="row">GASTADO REAL:</th>
                            <td>
                                <input type="text" class="form-control currency-input borderless" name="GASTADO_REAL" id="GASTADO_REAL" value="{{ presupuesto['gastado_real'] }}">
                            </td>
                            <td>
                                <input type="text" class="form-control currency-input borderless" name="PORCENTAJE_GASTADO" id="PORCENTAJE_GASTADO" value="{{ presupuesto['porcentaje_gastado'] }}" name="PORCENTAJE_GASTADO" style="width: 50px;">
                            </td>
                            <th scope="row">STATUS OBRA:</th>
                            <td>
                                <input type="text" class="form-control currency-input borderless" id="ESTATUS_OBRA" name="ESTATUS_OBRA" value="{{ presupuesto['estatus_proyecto'] }}">
                            </td>
                            <td>
                                <input type="text" class="form-control currency-input borderless" id="PORCENTAJE_ESTADO" placeholder="%0" name="PORCENTAJE_ESTADO" style="width: 50px;">
                            </td>
                            <th scope="row">TOTAL SEMANAS:</th>
                            <td>
                                <input type="text" class="form-control currency-input borderless" style="text-align: center;" id="DIAS_TOTALES" name="DIAS_TOTALES">
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
        </div>  
    </div>

    <div class="collapse" id="collapseExample">
        <div class="card card-body">
            <div class="form-group row">
                <!-- % POR COBRAR -->
                <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                    <label style="text-align: center;">% POR COBRAR</label>
                    <div class="progress" role="progressbar" aria-label="Example with label" aria-valuemin="0"
                        aria-valuemax="100">
                        <div class="progress-bar bg-success" id="progress-bar-cobrar" style="width: 25%">25%</div>
                    </div>
                </div>
                <!-- % PAGADO -->
                <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                    <label style="text-align: center;">% PAGADO</label>
                    <div class="progress" role="progressbar" aria-label="Example with label" aria-valuemin="0"
                        aria-valuemax="100">
                        <div class="progress-bar bg-success" id="progress-bar-pagado" style="width: 100%">100%</div>
                    </div>
                </div>
                <!-- % GASTADO -->
                <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                    <label style="text-align: center;">% GASTADO</label>
                    <div class="progress" role="progressbar" aria-label="Example with label" aria-valuemin="0"
                        aria-valuemax="100">
                        <div class="progress-bar bg-success" id="progress-bar-gastado" style="width: 25%">25%</div>
                    </div>
                </div>
                <!-- % POR GASTAR -->
                <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                    <label style="text-align: center;">% POR GASTAR</label>
                    <div class="progress" role="progressbar" aria-label="Example with label" aria-valuemin="0"
                        aria-valuemax="100">
                        <div class="progress-bar bg-success" id="progress-bar-gastar" style="width: 25%">25%</div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>


<br>

    <div class="container-fluid">
        <div class="card">
            <div class="card-body">
                <div class="container-fluid">
                    <br>
                    <div class="row">
                        <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                            <button class="btn botones add-row-btn"  type="button" onclick="añadirConcepto()">AGREGAR PARTIDA</button>
                        </div>
                    </div>
                    <br>
                    <!-- Contenedor donde se agregarán los modales dinámicamente -->
                    <div id="subpresupuestos">
    
                    </div>
                    <div class="table-presupuesto">
                        <table id="DETALLE_PRESUPUESTO" class="table table-hover table-borderless">
                            <colgroup>
                                <!-- Agrega más columnas según sea necesario -->
                                <col style="width: 40px;"> <!-- Primera columna -->
                                <col style="width: 350px;"> <!-- Segunda columna -->
                                <col style="width: 350px;"> <!-- Tercera columna -->
                                <col style="width: 130px;"> <!-- Cuarta columna -->
                                <col style="width: 130px;"> <!-- Quinta columna -->
                                <col style="width: 130px;"> <!-- Sexta columna -->
                                <col style="width: 90px;"> <!-- Séptima columna -->
                                <col style="width: 230px;"> <!-- Octava columna -->
                                <col style="width: 50px;"> <!-- Novena columna -->
                                <!-- Añade más columnas si es necesario -->
                            </colgroup>
                            <thead class="thead-dark" style="text-align: center;">
                                <tr>
                                    <th style="white-space: normal;word-wrap: break-word;">NO</th>
                                    <th>PARTIDA PRESUPUESTAL</th>
                                    <th>CONTRATISTA / PROVEEDOR</th>
                                    <th style="white-space: normal;word-wrap: break-word;">PRESUPUESTO CLIENTE COSTO DIRECTO IVA INC.</th>
                                    <th style="white-space: normal;word-wrap: break-word;">PRESUPUESTO CONTRATISTAS IVA INC.</th>
                                    <th style="white-space: normal;word-wrap: break-word;">DIFERENCIA PRESUPUESTOS</th>
                                    <th style="white-space: normal;word-wrap: break-word;">CONTRATO FIRMADO</th>
                                    <th>ESTATUS</th>
                                    <th></th>
                                    <!-- Agrega más encabezados si es necesario -->
                                </tr>
                            </thead>
                            <tbody>
                                {% for detalle in presupuesto['detalle_presupuesto'] %}
                                <tr>
                                    <td>{{ loop.index }}</td>
                                    <td>{{ detalle['concepto'] }}</td>
                                    <td style="display: flex; justify-content: center; align-items: center;">
                                        {% if detalle['id_proveedor'] == 0  %}
                                        <div id="contenedor_boton_subpresupuesto">
                                            <button type="button" class="btn botones" id="boto_modal_subpresupuesto1" data-bs-toggle="modal" data-bs-target="#modalPresupuesto_1">
                                              VER PRESUPUESTO BAUART
                                          </button>
                                        </div>
                                        {%else%}
                                        <select class="form-control" id="INPUT_PROVEEDOR_1" name="PROVEEDOR[]" onchange="sub_presupuesto(this,1)" disabled="">
                                            <option value="">SELECIONA UN PROVEEDOR</option>
                                            
                                        </select>
                                        <input type="text" class="form-control" style="display: none" id="INPUT_ID_PROVEEDOR" name="ID_PROVEDOR">
                                        <div class="invalid-feedback">
                                            Selecciona un proveedor
                                        </div>
                                        {%endif%}
                                    </td>
                                    <td>{{ detalle['presupuesto_cliente'] }}</td>
                                    <td>{{ detalle['presupuesto_contratista'] }}</td>
                                    <td>{{ detalle['diferencia'] }}</td>
                                    <td>
                                        <select id="CONTRATO_FIRMADO" name="CONTRATO_FIRMADO[]" class="form-control">
                                            <option value="0" {{ 'selected' if detalle['contrato_firmado'] == 0 else '' }}>NO</option>
                                            <option value="1" {{ 'selected' if detalle['contrato_firmado'] == 1 else '' }}>SÍ</option>
                                        </select>
                                        <div class="invalid-feedback">
                                            SELECIONA UNA OPCIÓN
                                        </div>
                                    </td>
                                    <td>
                                        <select id="CONTRATO_FIRMADO" name="CONTRATO_FIRMADO[]" class="form-control">
                                            <option value="0" {{ 'selected' if detalle['estatus'] == 0 else '' }}>PRESUPUESTO CARGADO</option>
                                            <option value="1" {{ 'selected' if detalle['estatus'] == 1 else '' }}>APROBADO POR DIRECTOR</option>
                                        </select>
                                        <div class="invalid-feedback">
                                            SELECIONA UNA OPCIÓN
                                        </div>
                                        
                                    </td>
    
                                </tr>
                                {% if detalle['id_proveedor'] == 0 and detalle['presupuesto_bauart'] %}
                                <!-- Subpresupuestos Bauart -->
                                <tr class="collapse" id="detalle-{{ detalle['id'] }}">
                                    <td colspan="9">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th>Concepto</th>
                                                    <th>Presupuesto Cliente</th>
                                                    <th>Presupuesto Contratista</th>
                                                    <th>Diferencia</th>
                                                    <th>Estatus</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for subdetalle in detalle['presupuesto_bauart']['detalles'] %}
                                                <tr>
                                                    <td>{{ subdetalle['concepto'] }}</td>
                                                    <td>{{ subdetalle['presupuesto_cliente'] }}</td>
                                                    <td>{{ subdetalle['presupuesto_contratista'] }}</td>
                                                    <td>{{ subdetalle['diferencia'] }}</td>
                                                    <td>{{ subdetalle['estatus'] }}</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                                {% endif %}
                                {% endfor %}
    
                            </tbody>
                            <tfoot>
                                <!-- Pie de tabla -->
                                <tr>
                                    <td colspan="3"class="text-end"><strong>SUBTOTAL:</strong></td>
                                    <td><input type="text" id="subtotalCliente" name="subtotalCliente" class="form-control  currency-input"
                                            placeholder="$0.00" readonly></td>
                                    <td><input type="text" id="subtotalContratista" name="subtotalContratista" class="form-control  currency-input"
                                            placeholder="$0.00" readonly></td>
                                    <td><input type="text" name="subtotalDiferencia" id="subtotalDiferencia" class="form-control  currency-input"
                                            placeholder="$0.00" readonly></td>
                                    <td colspan="3"></td>
                                </tr>
                                <tr>
                                   
                                    <td   colspan="3" class="text-end"><strong>% INDIRECTO:</strong></td>
                                    <td><input type="number" name="porcentajeIndirecto" id="porcentajeIndirecto" min='0' class="form-control"
                                            style="text-align: center;" placeholder="0"
                                            onchange="calcularTotalConIndirecto()"></td>
                                    <td colspan="5"></td>
                                </tr>
                                <tr>
                                
                                    <td  colspan="3" class="text-end"><strong>TOTAL INDIRECTO:</strong></td>
                                    <td><input type="text" id="totalIndirectoCliente" name="totalIndirectoCliente" class="form-control  currency-input"
                                            placeholder="$0.00" readonly></td>
                                    <td colspan="5"></td>
                                </tr>
                                <tr>
                                    <td colspan="3" class="text-end"><strong>TOTAL:</strong></td>
                                    <td><input type="text" id="totalCliente" name="totalCliente" class="form-control  currency-input"
                                            placeholder="$0.00" readonly></td>
                                    <td><input type="text" id="totalContratista" class="form-control  currency-input"
                                            placeholder="$0.00" readonly></td>
                                    <td><input type="text" id="totalDiferencia" class="form-control  currency-input"
                                            placeholder="$0.00" readonly></td>
                                    <td colspan="3"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <br>
    </div>
</form>
<script src="{{ url_for('static', filename='JS/funcionesAltaPresupuesto.js') }}"></script>


{% endblock %}
{% extends "layout.html" %}
{% block title %}MODIFICAR PRESUPUESTO{% endblock %}

{% block customCSS %}
<style>
    body {
        background-color: #d9e3eb;
    }

    .table {
        table-layout: fixed;
        width: 100%;
        border-collapse: collapse;
        position: relative;
        /* Para colocar los resizers */
    }

 

    th,
    td {
        padding: 10px;
        text-align: center;
        border: 1px solid #ddd;
    }

    /* Estilos para los resizers */
    .resizer {
        width: 5px;
        cursor: col-resize;
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        z-index: 1;
        background-color: #ddd;
        /* Color visible para el resizer */
    }

    .currency-input {
        text-align: right;
        width: 110px;
        /* Alinea el texto a la derecha para valores monetarios */
    }

    .borderless {
        border: none;
        /* Elimina los bordes de los inputs */
    }

    tfoot tr {
        background-color: #f8f9fa;
        /* Color de fondo para el pie de tabla */
    }

    tfoot td {
        padding: 10px;
        /* Espaciado interno en las celdas del pie de tabla */
    }

    th,
    td {
        padding: 10px;
        /* Espaciado interno para mejorar la legibilidad */
        text-align: center;
        /* Centra el texto de las celdas */
        border: 1px solid #ddd;
        /* Añade bordes a las celdas */
    }

    .table thead th {
        position: sticky;
        top: 0;
        background-color: #0f2d3a;
        color: #ffff;
        font-size: 12px;
        font-family: arial;
        margin: 0px;
        z-index: 2;
    }

    #DETALLE_PRESUPUESTO tfoot {
        position: sticky;
        bottom: 0;
        background-color: white;
        z-index: 2;

    }

    .form-label {
        font-family: arial;
        margin: 0px;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        display: block;

    }

    .presupuesto {
        background-color: #0f2d3a;
        color: #ffff;
        font-family: arial;
        margin: 0px;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        display: block;
    }

    .table-presupuesto  {
        max-height: 500px;
        overflow-y: auto;
        overflow-x: auto;
    }

    .table-presupuesto_sub  {
        max-height: 500px;
        overflow-y: auto;
        overflow-x: auto;
    }

    .table th,
    .table td {
        vertical-align: middle;
        white-space: nowrap;
        font-family: arial;

    }

    #heder-presupuestos th,
    #heder-presupuestos td {
        text-align: left;

    }


    .borderless {
        border: none;
        box-shadow: none;
        outline: none;

    }

    .xnu {
        font-family: arial;
        margin: 0px;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        display: block;
        font-size: 20px;
        font-weight: normal;
    }

    .card-header {
        font-size: 12px;
        font-family: arial;
        margin: 0px;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        display: block;

    }

    .table-borderless {
    border-collapse: collapse;
}

.table-borderless th,
.table-borderless td,
.table-borderless thead th,
.table-borderless tbody td,
.table-borderless tfoot th {
    border: none;
}

.table-borderless colgroup col {
    border: none;
}

    .modal-header{
        background-color: #0f2d3a; 
        color: #fff;
    }

    .modal-title {
        background-color: #0f2d3a; 
        color: #fff;
        font-size: 14px;
        font-family: arial;
        margin: 0px;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        display: block;

    }


    a.link {
        color: #0f2d3a;
        font-size: 12px;
        font-family: arial;
        margin: 0px;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        display: block;
    }

    .oculto {
        display: none;
    }

    @media (min-width: 1200px) {
    .modal-xl {
        --bs-modal-width: 1600px;
    }

    
}

#suggestions {
    position: absolute;
    z-index: 1000; /* Asegurar que esté encima de otros elementos */
    background: white;
    border: 1px solid #ccc;
    max-height: 50px; /* Limitar la altura si hay muchas sugerencias */
    overflow-y: auto; /* Habilitar el scroll */
  
}

#suggestions .list-group-item {
    cursor: pointer;
}

#suggestions .list-group-item:hover {
    background-color: #f0f0f0;
}

</style>
{% endblock %}

{% block titutlo %}MODIFICAR PRESUPUESTO{% endblock %}

{% block content %}

<!--MODAL PARA PARA PRESUPUESTO BAUART-->
<!--DAL PARA PARA PRESUPUESTO BAUART-->



<br>
<div class="container-fluid">
    <form class="needs-validation" novalidate accion="/Presupuestos" method="post">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <input type="hidden" name="token" value="{{ token }}">
    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
        <div class="text-center">
            <button class="btn botones" type="submit">CONFIRMA</button>
        </div>
    </div>

    <br>

    <div class="card mb-3">
        <div class="card-body">
           
            <div class="table-responsive">
                <table class="table table-borderless heder-presupuestos">
                    <colgroup>
                        <col style="width: 150px"> <!-- Primera columna -->
                        <col style="width: 400px;"> <!-- Segunda columna -->
                        <col style="width: 160px;"> <!-- Tercera columna -->
                        <col style="width: 130px;"> <!-- Cuarta columna -->
                        <col style="width: 60px;"> <!-- Quinta columna -->
                        <col style="width: 160px;"> <!-- Sexta columna -->
                        <col style="width: 130px;"> <!-- Séptima columna -->
                        <col style="width: 60px;"> <!-- Octava columna -->
                        <col style="width: 120px;"> <!-- Novena columna -->
                        <col style="width: 130px;"> 
                    </colgroup>
                    <thead></thead>
                    <tbody>
                        <tr>
                            <th scope="row" style="text-align: left;">NOMBRE PROYECTO:</th>
                            <td>
                            </td>
                                <input type="text" class="form-control form-control-sm"   value="{{ presupuesto['proyecto'] }} disabled id="PROYECTO" name="PROYECTO" autocomplete="off">
                            <th scope="row" style="text-align: left;">PRESUPUESTO CLIENTE:</th>
                            <td>
                                <input type="text"  value="{{ presupuesto['presupuesto_cliente'] }}" class="form-control currency-input borderless" name="PRESUPUESTO_CLIENTE" id="PRESUPUESTO_CLIENTE" placeholder="$0.00" readonly>
                            </td>
                            <td>
                                <th scope="row">FALTA POR COBRAR:</th>
                            <td>
                                <input type="text"   value="{{ presupuesto['falta_por_cobrar'] }}" class="form-control currency-input borderless" name="FALTA_COBRAR" id="FALTA_COBRAR" placeholder="$0.00">
                            </td>
                            <td>
                                <input type="text" value="%0" class="form-control currency-input borderless" id="PORCENTAJE_POR_COBRAR" placeholder="%0" name="PORCENTAJE_POR_COBRAR" style="width: 50px;">
                            </td>
                            <th scope="row">FECHA INICIO:</th>
                            <td>
                                <input type="date" name="FECHA_INICIO" class="form-control borderless" id="FECHA_INICIO">
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">DIRECCIÓN:</th>
                            <td>
                                <input type="text" class="form-control borderless" id="DIRECCION" name="DIRECCION" value="{{ presupuesto['id_director'] }}" readonly>
                            </td>
                            <th scope="row">PAGADO CLIENTE:</th>
                            <td>
                                <input type="text" class="form-control currency-input borderless" name="PAGADO_CLIENTE" id="PAGADO_CLIENTE" value="{{ presupuesto['pagado_cliente'] }}" readonly>
                            </td>
                            <td>
                                <input type="text" class="form-control currency-input borderless" id="PORCENTAJE_PAGADO_CLIENTE" placeholder="%0" name="PORCENTAJE_PAGADO_CLIENTE" style="width: 50px;">
                            </td>
                            <th scope="row">FALTA POR GASTAR:</th>
                            <td>
                                <input type="text" class="form-control currency-input borderless" name="FALTA_GASTAR"  id="FALTA_GASTAR"  value="{{ presupuesto['pagado_cliente'] }}">
                            </td>
                            <td>
                                <input type="text" class="form-control currency-input borderless" id="PORCENTAJE_POR_GASTAR" placeholder="%0" name="PORCENTAJE_POR_GASTAR" style="width: 50px;">
                            </td>
                            <th scope="row">FECHA FIN:</th>
                            <td>
                                <input type="date" name="FECHA_FIN" class="form-control borderless" id="FECHA_FIN">
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">DIRECTOR:</th>
                            <td>
                                <input type="text" class="form-control borderless" id="DIRECTOR" name="DIRECTOR" value="{{ presupuesto['id_director'] }}" readonly>
                            </td>
                            <th scope="row">GASTADO REAL:</th>
                            <td>
                                <input type="text" class="form-control currency-input borderless" name="GASTADO_REAL" id="GASTADO_REAL" value="{{ presupuesto['gastado_real'] }}">
                            </td>
                            <td>
                                <input type="text" class="form-control currency-input borderless" name="PORCENTAJE_GASTADO" id="PORCENTAJE_GASTADO" value="{{ presupuesto['porcentaje_gastado'] }}" name="PORCENTAJE_GASTADO" style="width: 50px;">
                            </td>
                            <th scope="row">STATUS OBRA:</th>
                            <td>
                                <input type="text" class="form-control currency-input borderless" id="ESTATUS_OBRA" name="ESTATUS_OBRA" value="{{ presupuesto['estatus_proyecto'] }}">
                            </td>
                            <td>
                                <input type="text" class="form-control currency-input borderless" id="PORCENTAJE_ESTADO" placeholder="%0" name="PORCENTAJE_ESTADO" style="width: 50px;">
                            </td>
                            <th scope="row">TOTAL SEMANAS:</th>
                            <td>
                                <input type="text" class="form-control currency-input borderless" style="text-align: center;" id="DIAS_TOTALES" name="DIAS_TOTALES">
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
        </div>  
    </div>

    <div class="collapse" id="collapseExample">
        <div class="card card-body">
            <div class="form-group row">
                <!-- % POR COBRAR -->
                <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                    <label style="text-align: center;">% POR COBRAR</label>
                    <div class="progress" role="progressbar" aria-label="Example with label" aria-valuemin="0"
                        aria-valuemax="100">
                        <div class="progress-bar bg-success" id="progress-bar-cobrar" style="width: 25%">25%</div>
                    </div>
                </div>
                <!-- % PAGADO -->
                <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                    <label style="text-align: center;">% PAGADO</label>
                    <div class="progress" role="progressbar" aria-label="Example with label" aria-valuemin="0"
                        aria-valuemax="100">
                        <div class="progress-bar bg-success" id="progress-bar-pagado" style="width: 100%">100%</div>
                    </div>
                </div>
                <!-- % GASTADO -->
                <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                    <label style="text-align: center;">% GASTADO</label>
                    <div class="progress" role="progressbar" aria-label="Example with label" aria-valuemin="0"
                        aria-valuemax="100">
                        <div class="progress-bar bg-success" id="progress-bar-gastado" style="width: 25%">25%</div>
                    </div>
                </div>
                <!-- % POR GASTAR -->
                <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                    <label style="text-align: center;">% POR GASTAR</label>
                    <div class="progress" role="progressbar" aria-label="Example with label" aria-valuemin="0"
                        aria-valuemax="100">
                        <div class="progress-bar bg-success" id="progress-bar-gastar" style="width: 25%">25%</div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>


<br>

    <div class="container-fluid">
        <div class="card">
            <div class="card-body">
                <div class="container-fluid">
                    <br>
                    <div class="row">
                        <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                            <button class="btn botones add-row-btn"  type="button" onclick="añadirConcepto()">AGREGAR PARTIDA</button>
                        </div>
                    </div>
                    <br>
                    <!-- Contenedor donde se agregarán los modales dinámicamente -->
                    <div id="subpresupuestos">
    
                    </div>
                    <div class="table-presupuesto">
                        <table id="DETALLE_PRESUPUESTO" class="table table-hover table-borderless">
                            <colgroup>
                                <!-- Agrega más columnas según sea necesario -->
                                <col style="width: 40px;"> <!-- Primera columna -->
                                <col style="width: 350px;"> <!-- Segunda columna -->
                                <col style="width: 350px;"> <!-- Tercera columna -->
                                <col style="width: 130px;"> <!-- Cuarta columna -->
                                <col style="width: 130px;"> <!-- Quinta columna -->
                                <col style="width: 130px;"> <!-- Sexta columna -->
                                <col style="width: 90px;"> <!-- Séptima columna -->
                                <col style="width: 230px;"> <!-- Octava columna -->
                                <col style="width: 50px;"> <!-- Novena columna -->
                                <!-- Añade más columnas si es necesario -->
                            </colgroup>
                            <thead class="thead-dark" style="text-align: center;">
                                <tr>
                                    <th style="white-space: normal;word-wrap: break-word;">NO</th>
                                    <th>PARTIDA PRESUPUESTAL</th>
                                    <th>CONTRATISTA / PROVEEDOR</th>
                                    <th style="white-space: normal;word-wrap: break-word;">PRESUPUESTO CLIENTE COSTO DIRECTO IVA INC.</th>
                                    <th style="white-space: normal;word-wrap: break-word;">PRESUPUESTO CONTRATISTAS IVA INC.</th>
                                    <th style="white-space: normal;word-wrap: break-word;">DIFERENCIA PRESUPUESTOS</th>
                                    <th style="white-space: normal;word-wrap: break-word;">CONTRATO FIRMADO</th>
                                    <th>ESTATUS</th>
                                    <th></th>
                                    <!-- Agrega más encabezados si es necesario -->
                                </tr>
                            </thead>
                            <tbody>
                                {% for detalle in presupuesto['detalle_presupuesto'] %}
                                <tr>
                                    <td>{{ loop.index }}</td>
                                    <td>{{ detalle['concepto'] }}</td>
                                    <td style="display: flex; justify-content: center; align-items: center;">
                                        {% if detalle['id_proveedor'] == 0  %}
                                        <div id="contenedor_boton_subpresupuesto">
                                            <button type="button" class="btn botones" id="boto_modal_subpresupuesto1" data-bs-toggle="modal" data-bs-target="#modalPresupuesto_1">
                                              VER PRESUPUESTO BAUART
                                          </button>
                                        </div>
                                        {%else%}
                                        <select class="form-control" id="INPUT_PROVEEDOR_1" name="PROVEEDOR[]" onchange="sub_presupuesto(this,1)" disabled="">
                                            <option value="">SELECIONA UN PROVEEDOR</option>
                                            
                                        </select>
                                        <input type="text" class="form-control" style="display: none" id="INPUT_ID_PROVEEDOR" name="ID_PROVEDOR">
                                        <div class="invalid-feedback">
                                            Selecciona un proveedor
                                        </div>
                                        {%endif%}
                                    </td>
                                    <td>{{ detalle['presupuesto_cliente'] }}</td>
                                    <td>{{ detalle['presupuesto_contratista'] }}</td>
                                    <td>{{ detalle['diferencia'] }}</td>
                                    <td>
                                        <select id="CONTRATO_FIRMADO" name="CONTRATO_FIRMADO[]" class="form-control">
                                            <option value="0" {{ 'selected' if detalle['contrato_firmado'] == 0 else '' }}>NO</option>
                                            <option value="1" {{ 'selected' if detalle['contrato_firmado'] == 1 else '' }}>SÍ</option>
                                        </select>
                                        <div class="invalid-feedback">
                                            SELECIONA UNA OPCIÓN
                                        </div>
                                    </td>
                                    <td>
                                        <select id="CONTRATO_FIRMADO" name="CONTRATO_FIRMADO[]" class="form-control">
                                            <option value="0" {{ 'selected' if detalle['estatus'] == 0 else '' }}>PRESUPUESTO CARGADO</option>
                                            <option value="1" {{ 'selected' if detalle['estatus'] == 1 else '' }}>APROBADO POR DIRECTOR</option>
                                        </select>
                                        <div class="invalid-feedback">
                                            SELECIONA UNA OPCIÓN
                                        </div>
                                        
                                    </td>
    
                                </tr>
                                {% if detalle['id_proveedor'] == 0 and detalle['presupuesto_bauart'] %}
                                <!-- Subpresupuestos Bauart -->
                                <tr class="collapse" id="detalle-{{ detalle['id'] }}">
                                    <td colspan="9">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th>Concepto</th>
                                                    <th>Presupuesto Cliente</th>
                                                    <th>Presupuesto Contratista</th>
                                                    <th>Diferencia</th>
                                                    <th>Estatus</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for subdetalle in detalle['presupuesto_bauart']['detalles'] %}
                                                <tr>
                                                    <td>{{ subdetalle['concepto'] }}</td>
                                                    <td>{{ subdetalle['presupuesto_cliente'] }}</td>
                                                    <td>{{ subdetalle['presupuesto_contratista'] }}</td>
                                                    <td>{{ subdetalle['diferencia'] }}</td>
                                                    <td>{{ subdetalle['estatus'] }}</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                                {% endif %}
                                {% endfor %}
    
                            </tbody>
                            <tfoot>
                                <!-- Pie de tabla -->
                                <tr>
                                    <td colspan="3"class="text-end"><strong>SUBTOTAL:</strong></td>
                                    <td><input type="text" id="subtotalCliente" name="subtotalCliente" class="form-control  currency-input"
                                            placeholder="$0.00" readonly></td>
                                    <td><input type="text" id="subtotalContratista" name="subtotalContratista" class="form-control  currency-input"
                                            placeholder="$0.00" readonly></td>
                                    <td><input type="text" name="subtotalDiferencia" id="subtotalDiferencia" class="form-control  currency-input"
                                            placeholder="$0.00" readonly></td>
                                    <td colspan="3"></td>
                                </tr>
                                <tr>
                                   
                                    <td   colspan="3" class="text-end"><strong>% INDIRECTO:</strong></td>
                                    <td><input type="number" name="porcentajeIndirecto" id="porcentajeIndirecto" min='0' class="form-control"
                                            style="text-align: center;" placeholder="0"
                                            onchange="calcularTotalConIndirecto()"></td>
                                    <td colspan="5"></td>
                                </tr>
                                <tr>
                                
                                    <td  colspan="3" class="text-end"><strong>TOTAL INDIRECTO:</strong></td>
                                    <td><input type="text" id="totalIndirectoCliente" name="totalIndirectoCliente" class="form-control  currency-input"
                                            placeholder="$0.00" readonly></td>
                                    <td colspan="5"></td>
                                </tr>
                                <tr>
                                    <td colspan="3" class="text-end"><strong>TOTAL:</strong></td>
                                    <td><input type="text" id="totalCliente" name="totalCliente" class="form-control  currency-input"
                                            placeholder="$0.00" readonly></td>
                                    <td><input type="text" id="totalContratista" class="form-control  currency-input"
                                            placeholder="$0.00" readonly></td>
                                    <td><input type="text" id="totalDiferencia" class="form-control  currency-input"
                                            placeholder="$0.00" readonly></td>
                                    <td colspan="3"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <br>
    </div>
</form>
<script src="{{ url_for('static', filename='JS/funcionesAltaPresupuesto.js') }}"></script>


{% endblock %}
