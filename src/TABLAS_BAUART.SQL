
-- Tabla USUARIOS
CREATE TABLE USUARIOS (
    ID INT PRIMARY KEY,
    ID_EMPRESA INT,
    NOMBRE_USUARIO VARCHAR(50) NOT NULL,
    NOMBRE VARCHAR(50) NOT NULL,
    CONTRASENA VARCHAR(MAX) NOT NULL,
    CORREO VARCHAR(250) NOT NULL,
    FECHA_REGISTRO DATE,
    IS_BLOCKED BIT DEFAULT (0),
    ID_EMPLEADO INT,
    FOREIGN KEY (ID_EMPRESA) REFERENCES EMPRESAS(ID),
    FOREIGN KEY (ID_EMPLEADO) REFERENCES EMPLEADOS(ID)
);


CREATE TABLE [EMPLEADOS] (
  [ID] INT PRIMARY KEY IDENTITY(1, 1),
  [NOMBRE] VARCHAR(250) NOT NULL,
  [APELLIDO] VARCHAR(250) NOT NULL,
  [ID_EMPRESA] INT,
  [PUESTO] INT,
  [TIPO_EMPLEADO] INT,
  [TIPO_NOMINA] INT,
  [SUELDO_IMSS] VARCHAR(50),
  [MONEDERO] VARCHAR(50),
  [NOMINA] VARCHAR(50),
  [BANCO] INT, 
  [NUMERO_CUENTA] NVARCHAR(50) NOT NULL,
  [CLABE] NVARCHAR(255) NOT NULL,
  [ALTA_EMPLEADO] DATE,
  [BAJA_EMPLEADO] DATE,
  [FECHA_REGISTRO] DATE,
  [IS_BLOCKED] BIT DEFAULT (0)
)
GO



 CREATE TABLE [PUESTOS] (
  [ID] INT PRIMARY KEY IDENTITY(1, 1),
  [PUESTO] VARCHAR(250),
  [SUELDO_BASE] DECIMAL(10, 2),
  [SUELDO_TARJETA] DECIMAL(10, 2),
  [HORA_EXTRA] DECIMAL(10, 2),
  [FECHA_REGISTRO] DATE DEFAULT GETDATE(),
  [CATEGORIA] INT,
  [IS_BLOCKED] BIT DEFAULT (0)
)
GO

CREATE TABLE [CATEGIRIAS] (
  [CATEGIRIA] INT,
  [FECHA_REGISTRO] DATE,
  [IS_BLOCKED] BIT DEFAULT (0)
)
GO



CREATE TABLE [EMPRESAS] (
  [ID] INT PRIMARY KEY IDENTITY(1, 1),
  [RAZON_SOCIAL] VARCHAR(100) NOT NULL,
  [RFC] VARCHAR(13) NOT NULL,
  [REPSE] VARCHAR(50) NOT NULL,
  [REGIMEN_FISCAL_ID] INT NOT NULL,
  [NOMBRE_REPRESENTANTE1] VARCHAR(50) NOT NULL,
  [APELLIDO_REPRESENTANTE1] VARCHAR(50) NOT NULL,
  [TELEFONO_REPRESENTANTE1] VARCHAR(50) NOT NULL,
  [CORREO_REPRESENTANTE1] VARCHAR(50) NOT NULL,
  [NOMBRE_REPRESENTANTE2] VARCHAR(50) NOT NULL,
  [APELLIDO_REPRESENTANTE2] VARCHAR(50) NOT NULL,
  [TELEFONO_REPRESENTANTE2] VARCHAR(50) NOT NULL,
  [CORREO_REPRESENTANTE2] VARCHAR(50) NOT NULL,
  [NOMBRE_APODERADO] VARCHAR(50) NOT NULL,
  [APELLIDO_APODERADO] VARCHAR(50) NOT NULL,
  [TELEFONO_APODERADO] VARCHAR(50) NOT NULL,
  [CORREO_APODERADO] VARCHAR(50) NOT NULL,
  [CP] VARCHAR(10) NOT NULL,
  [ESTADO] VARCHAR(50),
  [CIUDAD] VARCHAR(50),
  [DIRECCION] VARCHAR(50),
  [FECHA_REGISTRO] DATE,
  [USUARIO_ID] INT,
  [IS_BLOCKED] BIT DEFAULT (0)
)
GO

CREATE TABLE [CUENTAS_EMPRESAS] (
  [ID] INT PRIMARY KEY IDENTITY(1, 1),
  [ID_EMPRESA] INT,
  [ID_BANCO] INT,
  [NUMERO_CUENTA] VARCHAR(50) NOT NULL,
  [CLABE] NVARCHAR(50) NOT NULL,
  [FECHA_REGISTRO] DATE,
  [USUARIO_ID] INT,
  [IS_BLOCKED] BIT DEFAULT (0)
)
GO

CREATE TABLE [REGISTRO_PATRONALES] (
  [ID] INT PRIMARY KEY IDENTITY(1, 1),
  [ID_EMPRESA] INT,
  [NUMERO_REGISTRO_PATRONAL] VARCHAR(250) NOT NULL,
  [ESTADO] VARCHAR(100) NOT NULL,
  [FECHA_REGISTRO] DATE,
  [USUARIO_ID] INT,
  [IS_BLOCKED] BIT DEFAULT (0)
)
GO

CREATE TABLE [CLIENTES] (
  [ID] INT PRIMARY KEY IDENTITY(1, 1),
  [ID_EMPRESA] INT,
  [RAZON_SOCIAL] VARCHAR(100) NOT NULL,
  [RFC] VARCHAR(13) NOT NULL,
  [CP] VARCHAR(10) NOT NULL,
  [ESTADO] VARCHAR(50),
  [CIUDAD] VARCHAR(50),
  [MUNICIPIO] VARCHAR(50),
  [PAIS] VARCHAR(50),
  [CALLE] VARCHAR(50),
  [NO_EXTERIOR] VARCHAR(50),
  [REGIMEN_FISCAL_ID] INT NOT NULL,
  [USO_CFDI_ID] INT NOT NULL,
  [CONDICION_PAGO_ID] INT NOT NULL,
  [FORMA_PAGO_ID] INT NOT NULL,
  [FECHA_REGISTRO] DATE,
  [USUARIO_ID] INT,
  [IS_BLOCKED] BIT DEFAULT (0)
)
GO

CREATE TABLE [USOCFDI] (
  [ID] INT PRIMARY KEY IDENTITY(1, 1),
  [Clave] VARCHAR(3),
  [Descripcion] VARCHAR(255),
  [Aplicacion] VARCHAR(500)
)
GO

CREATE TABLE [CONTACTOS_CLIENTES] (
  [ID] INT PRIMARY KEY IDENTITY(1, 1),
  [ID_CLIENTE] INT,
  [NOMBRE] VARCHAR(100),
  [APELLIDO] VARCHAR(100),
  [PUESTO] VARCHAR(100),
  [TELEFONO] VARCHAR(20),
  [CORREO] VARCHAR(200),
  [FECHA_REGISTRO] DATE,
  [USUARIO_ID] INT,
  [IS_BLOCKED] BIT DEFAULT (0)
)
GO

CREATE TABLE [CUENTAS_CLIENTES] (
  [ID] INT PRIMARY KEY IDENTITY(1, 1),
  [ID_CLIENTE] INT,
  [ID_BANCO] INT,
  [NUMERO_CUENTA] NVARCHAR(50) NOT NULL,
  [CLABE] NVARCHAR(255) NOT NULL,
  [FECHA_REGISTRO] DATE,
  [USUARIO_ID] INT,
  [IS_BLOCKED] BIT DEFAULT (0)
)
GO

CREATE TABLE [BANCOS] (
  [ID] INT PRIMARY KEY IDENTITY(1, 1),
  [NOMBRE] VARCHAR(100),
  [FECHA_REGISTRO] DATE,
  [USUARIO_ID] INT,
  [IS_BLOCKED] BIT DEFAULT (0)
)
GO

CREATE TABLE [PROVEEDORES] (
  [ID] INT PRIMARY KEY IDENTITY(1, 1),
  [ID_EMPRESA] INT,
  [RAZON_SOCIAL] VARCHAR(200),
  [REGIMEN_FISCAL_ID] INT,
  [TIPO_ID] INT,
  [RFC] VARCHAR(13),
  [PAIS] VARCHAR(50),
  [ESTADO] VARCHAR(50),
  [CP] VARCHAR(10),
  [MUNICIPIO] VARCHAR(50),
  [COLONIA] VARCHAR(50),
  [CALLE] VARCHAR(50),
  [NUMERO_EXTERIOR] VARCHAR(50),
  [NUMERO_INTERIOR] VARCHAR(50),
  [FECHA_REGISTRO] DATE,
  [USUARIO_ID] INT,
  [IS_BLOCKED] BIT DEFAULT (0)
)
GO

CREATE TABLE [CONTACTOS_PROVEEDORES] (
  [ID] INT PRIMARY KEY IDENTITY(1, 1),
  [ID_PROVEEDOR] INT,
  [NOMBRE] VARCHAR(100),
  [APELLIDO] VARCHAR(100),
  [PUESTO] VARCHAR(100),
  [TELEFONO] VARCHAR(20),
  [CORREO] VARCHAR(200),
  [FECHA_REGISTRO] DATE,
  [USUARIO_ID] INT,
  [IS_BLOCKED] BIT DEFAULT (0)
)
GO

CREATE TABLE [CUENTAS_PROVEEDORES] (
  [ID] INT PRIMARY KEY IDENTITY(1, 1),
  [ID_PROVEEDOR] INT ,
  [ID_BANCO] INT NOT,
  [NUMERO_CUENTA] NVARCHAR(50) NOT NULL,
  [CLABE] NVARCHAR(255) NOT NULL,
  [FECHA_REGISTRO] DATE,
  [USUARIO_ID] INT,
  [IS_BLOCKED] BIT DEFAULT (0)
)
GO

CREATE TABLE [ESPECIALIDADES_PROVEEDORES] (
  [ID] INT PRIMARY KEY IDENTITY(1, 1),
  [ID_ESPECIALIDAD] INT ,
  [ID_PROVEEDOR] INT,
  [FECHA_REGISTRO] DATE,
  [USUARIO_ID] INT,
  [IS_BLOCKED] BIT DEFAULT (0)
)
GO

CREATE TABLE [CATALOGO_ESPECIALIDADES] (
  [ID] INT PRIMARY KEY IDENTITY(1, 1),
  [NOMBRE] NVARCHAR(255) NOT NULL,
  [IS_BLOCKED] BIT DEFAULT (0)
  [FECHA_REGISTRO] DATE,
  [USUARIO_ID] INT,
  [IS_BLOCKED] BIT DEFAULT (0)
)
GO

CREATE TABLE [PROYECTOS] (
  [ID] INT PRIMARY KEY IDENTITY(1, 1),
  [ID_EMPRESA] INT,
  [ID_CLIENTE] INT,
  [TIPO_ID] INT
  [FECHA_INICIO] DATE,
  [FECHA_CONTRATO] DATE,
  [FECHA_FIN] DATE,
  [NOMBRE_PROYECTO] NVARCHAR(255),
  [CENTRO_COMERCIAL] NVARCHAR(255),
  [PAIS] VARCHAR(50),
  [ESTADO] VARCHAR(50),
  [MUNICIPIO] VARCHAR(50),
  [COLONIA] VARCHAR(50),
  [CALLE] VARCHAR(50),
  [NUMERO_EXTERIOR] VARCHAR(50),
  [NUMERO_INTERIOR] VARCHAR(50),
  [DIRECTOR_PROYECTO] INT,
  [LIDER_PROYECTO] INT,
  [GERENTE_PROYECTO] INT,
  [LIDER1] INT,
  [LIDER2] INT,
  [FECHA_REGISTRO] DATE,
  [USUARIO_ID] INT,
  [IS_BLOCKED] BIT DEFAULT (0)
)
GO

-- Tabla: PRESUPUESTOS
CREATE TABLE Presupuestos (
    id_presupuesto INT IDENTITY(1,1) PRIMARY KEY,
    id_cliente INT,
    id_director VARCHAR(100) NOT NULL,
    id_empresa INT,
    id_proyecto VARCHAR(100) NOT NULL,
    usuario INT,
    estatus_proyecto VARCHAR(50) NULL,
    presupuesto_cliente DECIMAL(10, 2) NOT NULL,
    sub_proveedor DECIMAL(10, 2) NOT NULL,
    subtotal_cliente_iva DECIMAL(10, 2) NOT NULL,
    total_cliente_iva DECIMAL(10, 2) NOT NULL,
    indirecto_cliente_iva DECIMAL(10, 2) NOT NULL,
    sub_diferencia DECIMAL(10, 2) NOT NULL,
    pagado_cliente DECIMAL(10, 2) NOT NULL,
    porcentaje_pagado DECIMAL(5, 2) NOT NULL,
    falta_por_cobrar DECIMAL(10, 2) NOT NULL,
    falta_por_gastar DECIMAL(10, 2) NOT NULL
);
GO

-- Tabla: DETALLES_PRESUPUESTO
CREATE TABLE DetallesPresupuesto (
    id_detalle INT IDENTITY(1,1) PRIMARY KEY,
    id_presupuesto INT NOT NULL FOREIGN KEY REFERENCES Presupuestos(id_presupuesto),
    id_concepto VARCHAR(50) NOT NULL,
    id_proveedor INT,
    concepto VARCHAR(100) NOT NULL,
    contrato_firmado BIT NOT NULL DEFAULT 0,
    presupuesto_cliente DECIMAL(10, 2) NOT NULL,
    presupuesto_contratista DECIMAL(10, 2) NOT NULL,
    diferencia DECIMAL(10, 2) NOT NULL,
    is_blocked BIT NOT NULL DEFAULT 0
);
GO

-- Tabla: PRESUPUESTOS_BAUART
CREATE TABLE PresupuestosBauart (
    id_presupuesto_bauart INT IDENTITY(1,1) PRIMARY KEY,
    id_detalle INT,
    nombre_presupuesto VARCHAR(100) NOT NULL,
    total_presupuesto_cliente DECIMAL(10, 2) NOT NULL,
    total_presupuesto_proveedor DECIMAL(10, 2) NOT NULL,
    diferencia_presupuesto DECIMAL(10, 2) NOT NULL,
    is_blocked BIT NOT NULL DEFAULT 0
);
GO

-- Tabla: DETALLES_BAUART
CREATE TABLE DetallesBauart (
    id_detalle_bauart INT IDENTITY(1,1) PRIMARY KEY,
    id_presupuesto_bauart INT,
    id_concepto INT,
    concepto VARCHAR(100) NOT NULL,
    presupuesto_cliente DECIMAL(10, 2) NOT NULL,
    presupuesto_contratista DECIMAL(10, 2) NOT NULL,
    diferencia DECIMAL(10, 2) NOT NULL,
    id_proveedor INT,
    is_non  omina INT NOT NULL DEFAULT, 
    is_blocked BIT NOT NULL DEFAULT 0
);
GO


ALTER TABLE DetallesBauart
ADD is_nomina BIT NOT NULL DEFAULT 0,
    id_concepto INT
    


ALTER TABLE Presupuestos
ADD is_blocked BIT NOT NULL DEFAULT 0
    porcentaje_gastado DECIMAL(5, 2) NOT NULL DEFAULT 0.0,
    porcentaje_por_gastar DECIMAL(5, 2) NOT NULL DEFAULT 0.0;
-- Relaciones entre tablas

ALTER TABLE [USUARIOS] ADD FOREIGN KEY ([ID_EMPRESA]) REFERENCES [EMPRESAS] ([ID])
GO

ALTER TABLE [EMPRESAS] ADD FOREIGN KEY ([USUARIO_ID]) REFERENCES [USUARIOS] ([ID])
GO

ALTER TABLE [CUENTAS_EMPRESAS] ADD FOREIGN KEY ([ID_EMPRESA]) REFERENCES [EMPRESAS] ([ID])
GO

ALTER TABLE [CUENTAS_EMPRESAS] ADD FOREIGN KEY ([ID_BANCO]) REFERENCES [BANCOS] ([ID])
GO

ALTER TABLE [CUENTAS_EMPRESAS] ADD FOREIGN KEY ([USUARIO_ID]) REFERENCES [USUARIOS] ([ID])
GO

ALTER TABLE [REGISTRO_PATRONALES] ADD FOREIGN KEY ([ID_EMPRESA]) REFERENCES [EMPRESAS] ([ID])
GO

ALTER TABLE [REGISTRO_PATRONALES] ADD FOREIGN KEY ([USUARIO_ID]) REFERENCES [USUARIOS] ([ID])
GO

ALTER TABLE [CLIENTES] ADD FOREIGN KEY ([ID_EMPRESA]) REFERENCES [EMPRESAS] ([ID])
GO

ALTER TABLE [CLIENTES] ADD FOREIGN KEY ([USO_CFDI_ID]) REFERENCES [USOCFDI] ([ID])
GO

ALTER TABLE [CLIENTES] ADD FOREIGN KEY ([USUARIO_ID]) REFERENCES [USUARIOS] ([ID])
GO

ALTER TABLE [CONTACTOS_CLIENTES] ADD FOREIGN KEY ([ID_CLIENTE]) REFERENCES [CLIENTES] ([ID])
GO

ALTER TABLE [CONTACTOS_CLIENTES] ADD FOREIGN KEY ([USUARIO_ID]) REFERENCES [USUARIOS] ([ID])
GO

ALTER TABLE [CUENTAS_CLIENTES] ADD FOREIGN KEY ([ID_CLIENTE]) REFERENCES [CLIENTES] ([ID])
GO

ALTER TABLE [CUENTAS_CLIENTES] ADD FOREIGN KEY ([ID_BANCO]) REFERENCES [BANCOS] ([ID])
GO

ALTER TABLE [CUENTAS_CLIENTES] ADD FOREIGN KEY ([USUARIO_ID]) REFERENCES [USUARIOS] ([ID])
GO

ALTER TABLE [BANCOS] ADD FOREIGN KEY ([USUARIO_ID]) REFERENCES [USUARIOS] ([ID])
GO

ALTER TABLE [PROVEEDORES] ADD FOREIGN KEY ([ID_EMPRESA]) REFERENCES [EMPRESAS] ([ID])
GO

ALTER TABLE [PROVEEDORES] ADD FOREIGN KEY ([USUARIO_ID]) REFERENCES [USUARIOS] ([ID])
GO

ALTER TABLE [CONTACTOS_PROVEEDORES] ADD FOREIGN KEY ([ID_PROVEEDOR]) REFERENCES [PROVEEDORES] ([ID])
GO

ALTER TABLE [CONTACTOS_PROVEEDORES] ADD FOREIGN KEY ([USUARIO_ID]) REFERENCES [USUARIOS] ([ID])
GO

ALTER TABLE [CUENTAS_PROVEEDORES] ADD FOREIGN KEY ([ID_PROVEEDOR]) REFERENCES [PROVEEDORES] ([ID])
GO

ALTER TABLE [CUENTAS_PROVEEDORES] ADD FOREIGN KEY ([ID_BANCO]) REFERENCES [BANCOS] ([ID])
GO

ALTER TABLE [CUENTAS_PROVEEDORES] ADD FOREIGN KEY ([USUARIO_ID]) REFERENCES [USUARIOS] ([ID])
GO

ALTER TABLE [ESPECIALIDADES_PROVEEDORES] ADD FOREIGN KEY ([ID_ESPECIALIDAD]) REFERENCES [CATALOGO_ESPECIALIDADES] ([ID])
GO

ALTER TABLE [ESPECIALIDADES_PROVEEDORES] ADD FOREIGN KEY ([ID_PROVEEDOR]) REFERENCES [PROVEEDORES] ([ID])
GO

ALTER TABLE [ESPECIALIDADES_PROVEEDORES] ADD FOREIGN KEY ([USUARIO_ID]) REFERENCES [USUARIOS] ([ID])
GO

ALTER TABLE [PROYECTOS] ADD FOREIGN KEY ([ID_EMPRESA]) REFERENCES [EMPRESAS] ([ID])
GO

ALTER TABLE [PROYECTOS] ADD FOREIGN KEY ([ID_CLIENTE]) REFERENCES [CLIENTES] ([ID])
GO

ALTER TABLE [PROYECTOS] ADD FOREIGN KEY ([USUARIO_ID]) REFERENCES [USUARIOS] ([ID])
GO

ALTER TABLE [PRESUPUESTOS] ADD FOREIGN KEY ([ID_PROYECTO]) REFERENCES [PROYECTOS] ([ID])
GO

ALTER TABLE [DETALLE_PRESUPUESTO] ADD FOREIGN KEY ([ID_PRESUPUESTO]) REFERENCES [PRESUPUESTOS] ([ID])
GO
